   1                     ; C Compiler for STM8 (COSMIC Software)
   2                     ; Parser V4.11.14 - 18 Nov 2019
   3                     ; Generator (Limited) V4.4.11 - 19 Nov 2019
   4                     ; Optimizer V4.4.11 - 19 Nov 2019
2518                     .iconst:	section	.bss
2519  05fe               _stack_limit2:
2520  05fe 00            	ds.b	1
2521  05ff               _stack_limit1:
2522  05ff 00            	ds.b	1
2523                     .const:	section	.text
2524  9e68               L5261_devicetype:
2525  9e68 4e6574776f72  	dc.b	"NetworkModule/",0
2624                     ; 296 int main(void)
2624                     ; 297 {
2626                     .text:	section	.text,new
2627  bd4f               _main:
2629  bd4f 88            	push	a
2630       00000001      OFST:	set	1
2633                     ; 301   parse_complete = 0;
2635  bd50 725f0106      	clr	_parse_complete
2636                     ; 302   mqtt_parse_complete = 0;
2638  bd54 725f0105      	clr	_mqtt_parse_complete
2639                     ; 303   reboot_request = 0;
2641  bd58 725f010b      	clr	_reboot_request
2642                     ; 304   user_reboot_request = 0;
2644  bd5c 725f010a      	clr	_user_reboot_request
2645                     ; 305   restart_request = 0;
2647  bd60 725f0109      	clr	_restart_request
2648                     ; 307   time_mark2 = 0;           // Time capture used in reboot
2650  bd64 5f            	clrw	x
2651  bd65 cf00fd        	ldw	_time_mark2+2,x
2652  bd68 cf00fb        	ldw	_time_mark2,x
2653                     ; 310   restart_reboot_step = RESTART_REBOOT_IDLE;
2655  bd6b 725f0108      	clr	_restart_reboot_step
2656                     ; 311   mqtt_close_tcp = 0;
2658  bd6f 725f0107      	clr	_mqtt_close_tcp
2659                     ; 312   stack_error = 0;
2661  bd73 725f0163      	clr	_stack_error
2662                     ; 315   mqtt_start = MQTT_START_TCP_CONNECT;	 // Tracks the MQTT startup steps
2664  bd77 350100a8      	mov	_mqtt_start,#1
2665                     ; 316   mqtt_start_status = MQTT_START_NOT_STARTED; // Tracks error states during
2667  bd7b 725f00a7      	clr	_mqtt_start_status
2668                     ; 318   mqtt_keep_alive = 60;                  // Ping interval in seconds
2670  bd7f ae003c        	ldw	x,#60
2671  bd82 cf00f1        	ldw	_mqtt_keep_alive,x
2672                     ; 320   mqtt_start_ctr1 = 0;			 // Tracks time for the MQTT startup
2674  bd85 725f00a6      	clr	_mqtt_start_ctr1
2675                     ; 322   mqtt_start_ctr2 = 0;			 // Tracks time for the MQTT startup
2677  bd89 725f00a5      	clr	_mqtt_start_ctr2
2678                     ; 324   mqtt_sanity_ctr = 0;			 // Tracks time for the MQTT sanity
2680  bd8d 725f00a4      	clr	_mqtt_sanity_ctr
2681                     ; 326   mqtt_start_retry = 0;                  // Flag to retry the ARP/TCP Connect
2683  bd91 725f00a3      	clr	_mqtt_start_retry
2684                     ; 327   MQTT_error_status = 0;                 // For MQTT error status display in
2686  bd95 725f029b      	clr	_MQTT_error_status
2687                     ; 329   mqtt_restart_step = MQTT_RESTART_IDLE; // Step counter for MQTT restart
2689  bd99 725f00a0      	clr	_mqtt_restart_step
2690                     ; 330   strcpy(topic_base, devicetype);        // Initial content of the topic_base.
2692  bd9d ae0074        	ldw	x,#_topic_base
2693  bda0 90ae9e68      	ldw	y,#L5261_devicetype
2694  bda4               L6:
2695  bda4 90f6          	ld	a,(y)
2696  bda6 905c          	incw	y
2697  bda8 f7            	ld	(x),a
2698  bda9 5c            	incw	x
2699  bdaa 4d            	tnz	a
2700  bdab 26f7          	jrne	L6
2701                     ; 336   state_request = STATE_REQUEST_IDLE;    // Set the state request received to
2703  bdad c70164        	ld	_state_request,a
2704                     ; 338   TXERIF_counter = 0;                    // Initialize the TXERIF error counter
2706  bdb0 5f            	clrw	x
2707  bdb1 cf006d        	ldw	_TXERIF_counter+2,x
2708  bdb4 cf006b        	ldw	_TXERIF_counter,x
2709                     ; 339   RXERIF_counter = 0;                    // Initialize the RXERIF error counter
2711  bdb7 cf0071        	ldw	_RXERIF_counter+2,x
2712  bdba cf006f        	ldw	_RXERIF_counter,x
2713                     ; 340   TRANSMIT_counter = 0;
2715  bdbd cf0069        	ldw	_TRANSMIT_counter+2,x
2716  bdc0 cf0067        	ldw	_TRANSMIT_counter,x
2717                     ; 346   clock_init();            // Initialize and enable clocks and timers
2719  bdc3 cde580        	call	_clock_init
2721                     ; 348   gpio_init();             // Initialize and enable gpio pins
2723  bdc6 cda41b        	call	_gpio_init
2725                     ; 350   spi_init();              // Initialize the SPI bit bang interface to the
2727  bdc9 cde488        	call	_spi_init
2729                     ; 353   LEDcontrol(1);           // turn LED on
2731  bdcc a601          	ld	a,#1
2732  bdce cda464        	call	_LEDcontrol
2734                     ; 355   unlock_eeprom();         // unlock the EEPROM so writes can be performed
2736  bdd1 cdc439        	call	_unlock_eeprom
2738                     ; 357   check_eeprom_settings(); // Check the EEPROM for previously stored Address
2740  bdd4 cdc449        	call	_check_eeprom_settings
2742                     ; 361   Enc28j60Init();          // Initialize the ENC28J60 ethernet interface
2744  bdd7 cda024        	call	_Enc28j60Init
2746                     ; 363   uip_arp_init();          // Initialize the ARP module
2748  bdda cdf1f1        	call	_uip_arp_init
2750                     ; 365   uip_init();              // Initialize uIP Web Server
2752  bddd cde78e        	call	_uip_init
2754                     ; 367   HttpDInit();             // Initialize listening ports
2756  bde0 cdac89        	call	_HttpDInit
2758                     ; 374   stack_limit1 = 0xaa;
2760  bde3 35aa05ff      	mov	_stack_limit1,#170
2761                     ; 375   stack_limit2 = 0x55;
2763  bde7 355505fe      	mov	_stack_limit2,#85
2764                     ; 380   mqtt_init(&mqttclient,
2764                     ; 381             mqtt_sendbuf,
2764                     ; 382 	    sizeof(mqtt_sendbuf),
2764                     ; 383 	    &uip_buf[UIP_IPTCPH_LEN + UIP_LLH_LEN],
2764                     ; 384 	    UIP_APPDATA_SIZE,
2764                     ; 385 	    publish_callback);
2766  bdeb aec1a1        	ldw	x,#_publish_callback
2767  bdee 89            	pushw	x
2768  bdef ae01be        	ldw	x,#446
2769  bdf2 89            	pushw	x
2770  bdf3 ae03a9        	ldw	x,#_uip_buf+54
2771  bdf6 89            	pushw	x
2772  bdf7 ae00c8        	ldw	x,#200
2773  bdfa 89            	pushw	x
2774  bdfb ae016f        	ldw	x,#_mqtt_sendbuf
2775  bdfe 89            	pushw	x
2776  bdff ae00c5        	ldw	x,#_mqttclient
2777  be02 cdd030        	call	_mqtt_init
2779  be05 5b0a          	addw	sp,#10
2780  be07               L1561:
2781                     ; 499     uip_len = Enc28j60Receive(uip_buf); // Check for incoming packets
2783  be07 ae0373        	ldw	x,#_uip_buf
2784  be0a cda184        	call	_Enc28j60Receive
2786  be0d cf036f        	ldw	_uip_len,x
2787                     ; 501     if (uip_len > 0) {
2789  be10 2738          	jreq	L5561
2790                     ; 505       if (((struct uip_eth_hdr *) & uip_buf[0])->type == htons(UIP_ETHTYPE_IP)) {
2792  be12 ae0800        	ldw	x,#2048
2793  be15 cdf1cc        	call	_htons
2795  be18 c3037f        	cpw	x,_uip_buf+12
2796  be1b 2612          	jrne	L7561
2797                     ; 506         uip_input(); // Calls uip_process(UIP_DATA) to process a received
2799  be1d a601          	ld	a,#1
2800  be1f cde89e        	call	_uip_process
2802                     ; 511         if (uip_len > 0) {
2804  be22 ce036f        	ldw	x,_uip_len
2805  be25 2723          	jreq	L5561
2806                     ; 512           uip_arp_out();
2808  be27 cdf41a        	call	_uip_arp_out
2810                     ; 516           Enc28j60Send(uip_buf, uip_len);
2812  be2a ce036f        	ldw	x,_uip_len
2814  be2d 2013          	jp	LC001
2815  be2f               L7561:
2816                     ; 519       else if (((struct uip_eth_hdr *) & uip_buf[0])->type == htons(UIP_ETHTYPE_ARP)) {
2818  be2f ae0806        	ldw	x,#2054
2819  be32 cdf1cc        	call	_htons
2821  be35 c3037f        	cpw	x,_uip_buf+12
2822  be38 2610          	jrne	L5561
2823                     ; 520         uip_arp_arpin();
2825  be3a cdf36b        	call	_uip_arp_arpin
2827                     ; 524         if (uip_len > 0) {
2829  be3d ce036f        	ldw	x,_uip_len
2830  be40 2708          	jreq	L5561
2831                     ; 528           Enc28j60Send(uip_buf, uip_len);
2834  be42               LC001:
2835  be42 89            	pushw	x
2836  be43 ae0373        	ldw	x,#_uip_buf
2837  be46 cda231        	call	_Enc28j60Send
2838  be49 85            	popw	x
2839  be4a               L5561:
2840                     ; 538     if (mqtt_start != MQTT_START_COMPLETE
2840                     ; 539      && mqtt_restart_step == MQTT_RESTART_IDLE
2840                     ; 540      && restart_reboot_step == RESTART_REBOOT_IDLE) {
2842  be4a c600a8        	ld	a,_mqtt_start
2843  be4d a114          	cp	a,#20
2844  be4f 270d          	jreq	L1761
2846  be51 c600a0        	ld	a,_mqtt_restart_step
2847  be54 2608          	jrne	L1761
2849  be56 c60108        	ld	a,_restart_reboot_step
2850  be59 2603          	jrne	L1761
2851                     ; 541        mqtt_startup();
2853  be5b cdbec4        	call	_mqtt_startup
2855  be5e               L1761:
2856                     ; 545     if (restart_reboot_step == RESTART_REBOOT_IDLE) {
2858  be5e c60108        	ld	a,_restart_reboot_step
2859  be61 2603          	jrne	L3761
2860                     ; 546       mqtt_sanity_check();
2862  be63 cdc0ea        	call	_mqtt_sanity_check
2864  be66               L3761:
2865                     ; 550     if (periodic_timer_expired()) {
2867  be66 cde612        	call	_periodic_timer_expired
2869  be69 4d            	tnz	a
2870  be6a 2743          	jreq	L5761
2871                     ; 552       for(i = 0; i < UIP_CONNS; i++) {
2873  be6c 4f            	clr	a
2874  be6d 6b01          	ld	(OFST+0,sp),a
2876  be6f               L5071:
2877                     ; 553 	uip_periodic(i);
2879  be6f 97            	ld	xl,a
2880  be70 a629          	ld	a,#41
2881  be72 42            	mul	x,a
2882  be73 1c02c9        	addw	x,#_uip_conns
2883  be76 cf036d        	ldw	_uip_conn,x
2886  be79 a602          	ld	a,#2
2887  be7b cde89e        	call	_uip_process
2889                     ; 572 	if (uip_len > 0) {
2891  be7e ce036f        	ldw	x,_uip_len
2892  be81 270e          	jreq	L1171
2893                     ; 573 	  uip_arp_out(); // Verifies arp entry in the ARP table and builds LLH
2895  be83 cdf41a        	call	_uip_arp_out
2897                     ; 574           Enc28j60Send(uip_buf, uip_len);
2899  be86 ce036f        	ldw	x,_uip_len
2900  be89 89            	pushw	x
2901  be8a ae0373        	ldw	x,#_uip_buf
2902  be8d cda231        	call	_Enc28j60Send
2904  be90 85            	popw	x
2905  be91               L1171:
2906                     ; 577         mqtt_start_ctr1++; // Increment the MQTT start loop timer 1. This is
2908  be91 725c00a6      	inc	_mqtt_start_ctr1
2909                     ; 581         mqtt_start_ctr2++; // Increment the MQTT start loop timer 2. This is
2911  be95 725c00a5      	inc	_mqtt_start_ctr2
2912                     ; 584         mqtt_sanity_ctr++; // Increment the MQTT sanity loop timer. This is
2914  be99 725c00a4      	inc	_mqtt_sanity_ctr
2915                     ; 552       for(i = 0; i < UIP_CONNS; i++) {
2917  be9d 0c01          	inc	(OFST+0,sp)
2921  be9f 7b01          	ld	a,(OFST+0,sp)
2922  bea1 a104          	cp	a,#4
2923  bea3 25ca          	jrult	L5071
2924                     ; 594       if (mqtt_start == MQTT_START_COMPLETE) {
2926  bea5 c600a8        	ld	a,_mqtt_start
2927  bea8 a114          	cp	a,#20
2928  beaa 2603          	jrne	L5761
2929                     ; 595         publish_outbound();
2931  beac cdc24e        	call	_publish_outbound
2933  beaf               L5761:
2934                     ; 602     if (arp_timer_expired()) {
2936  beaf cde64b        	call	_arp_timer_expired
2938  beb2 4d            	tnz	a
2939  beb3 2703          	jreq	L5171
2940                     ; 603       uip_arp_timer(); // Clean out old ARP Table entries. Any entry that has
2942  beb5 cdf214        	call	_uip_arp_timer
2944  beb8               L5171:
2945                     ; 610     check_runtime_changes();
2947  beb8 cdc953        	call	_check_runtime_changes
2949                     ; 613     check_reset_button();
2951  bebb cdceed        	call	_check_reset_button
2953                     ; 618     check_restart_reboot();
2955  bebe cdcc5c        	call	_check_restart_reboot
2958  bec1 ccbe07        	jra	L1561
3009                     ; 646 void mqtt_startup(void)
3009                     ; 647 {
3010                     .text:	section	.text,new
3011  bec4               _mqtt_startup:
3015                     ; 663   if (mqtt_start == MQTT_START_TCP_CONNECT) {
3017  bec4 c600a8        	ld	a,_mqtt_start
3018  bec7 a101          	cp	a,#1
3019  bec9 2630          	jrne	L7271
3020                     ; 664     if (stored_mqttserveraddr[3] != 0) {
3022  becb c64034        	ld	a,_stored_mqttserveraddr+3
3023  bece 2603ccc0e9    	jreq	L7371
3024                     ; 684       mqtt_conn = uip_connect(&uip_mqttserveraddr, Port_Mqttd, Port_Mqttd);
3026  bed3 ce00f6        	ldw	x,_Port_Mqttd
3027  bed6 89            	pushw	x
3028  bed7 89            	pushw	x
3029  bed8 ae02b4        	ldw	x,#_uip_mqttserveraddr
3030  bedb cde7bd        	call	_uip_connect
3032  bede 5b04          	addw	sp,#4
3033  bee0 cf00a1        	ldw	_mqtt_conn,x
3034                     ; 685       if (mqtt_conn != NULL) {
3036  bee3 2711          	jreq	L3371
3037                     ; 686         mqtt_start_ctr1 = 0; // Clear 100ms counter
3039  bee5 725f00a6      	clr	_mqtt_start_ctr1
3040                     ; 687         mqtt_start_ctr2 = 0; // Clear 100ms counter
3042  bee9 725f00a5      	clr	_mqtt_start_ctr2
3043                     ; 688         mqtt_start_status = MQTT_START_CONNECTIONS_GOOD;
3045  beed 351000a7      	mov	_mqtt_start_status,#16
3046                     ; 689         mqtt_start = MQTT_START_VERIFY_ARP;
3048  bef1 350200a8      	mov	_mqtt_start,#2
3051  bef5 81            	ret	
3052  bef6               L3371:
3053                     ; 692         mqtt_start_status |= MQTT_START_CONNECTIONS_ERROR;
3055  bef6 721000a7      	bset	_mqtt_start_status,#0
3057  befa 81            	ret	
3058  befb               L7271:
3059                     ; 697   else if (mqtt_start == MQTT_START_VERIFY_ARP
3059                     ; 698         && mqtt_start_ctr2 > 10) {
3061  befb a102          	cp	a,#2
3062  befd 263a          	jrne	L1471
3064  beff c600a5        	ld	a,_mqtt_start_ctr2
3065  bf02 a10b          	cp	a,#11
3066  bf04 2533          	jrult	L1471
3067                     ; 699     mqtt_start_ctr2 = 0; // Clear 100ms counter
3069  bf06 725f00a5      	clr	_mqtt_start_ctr2
3070                     ; 706     if (check_mqtt_server_arp_entry() == 1) {
3072  bf0a cdf565        	call	_check_mqtt_server_arp_entry
3074  bf0d 5a            	decw	x
3075  bf0e 2611          	jrne	L3471
3076                     ; 708       mqtt_start_retry = 0;
3078  bf10 725f00a3      	clr	_mqtt_start_retry
3079                     ; 709       mqtt_start_ctr1 = 0; // Clear 100ms counter
3081  bf14 725f00a6      	clr	_mqtt_start_ctr1
3082                     ; 710       mqtt_start_status |= MQTT_START_ARP_REQUEST_GOOD;
3084  bf18 721a00a7      	bset	_mqtt_start_status,#5
3085                     ; 711       mqtt_start = MQTT_START_VERIFY_TCP;
3087  bf1c 350300a8      	mov	_mqtt_start,#3
3090  bf20 81            	ret	
3091  bf21               L3471:
3092                     ; 713     else if (mqtt_start_ctr1 > 150) {
3094  bf21 c600a6        	ld	a,_mqtt_start_ctr1
3095  bf24 a197          	cp	a,#151
3096  bf26 25a8          	jrult	L7371
3097                     ; 716       mqtt_start_status |= MQTT_START_ARP_REQUEST_ERROR;
3099  bf28 721200a7      	bset	_mqtt_start_status,#1
3100                     ; 717       mqtt_start = MQTT_START_TCP_CONNECT;
3102  bf2c 350100a8      	mov	_mqtt_start,#1
3103                     ; 719       mqtt_start_status = MQTT_START_NOT_STARTED;
3105  bf30 725f00a7      	clr	_mqtt_start_status
3106                     ; 720       mqtt_start_retry++;
3108  bf34 725c00a3      	inc	_mqtt_start_retry
3110  bf38 81            	ret	
3111  bf39               L1471:
3112                     ; 724   else if (mqtt_start == MQTT_START_VERIFY_TCP
3112                     ; 725         && mqtt_start_ctr2 > 10) {
3114  bf39 c600a8        	ld	a,_mqtt_start
3115  bf3c a103          	cp	a,#3
3116  bf3e 263e          	jrne	L3571
3118  bf40 c600a5        	ld	a,_mqtt_start_ctr2
3119  bf43 a10b          	cp	a,#11
3120  bf45 2537          	jrult	L3571
3121                     ; 726     mqtt_start_ctr2 = 0; // Clear 100ms counter
3123  bf47 725f00a5      	clr	_mqtt_start_ctr2
3124                     ; 734     if ((mqtt_conn->tcpstateflags & UIP_TS_MASK) == UIP_ESTABLISHED) {
3126  bf4b ce00a1        	ldw	x,_mqtt_conn
3127  bf4e e619          	ld	a,(25,x)
3128  bf50 a40f          	and	a,#15
3129  bf52 a103          	cp	a,#3
3130  bf54 260d          	jrne	L5571
3131                     ; 735       mqtt_start_retry = 0;
3133  bf56 725f00a3      	clr	_mqtt_start_retry
3134                     ; 736       mqtt_start_status |= MQTT_START_TCP_CONNECT_GOOD;
3136  bf5a 721c00a7      	bset	_mqtt_start_status,#6
3137                     ; 737       mqtt_start = MQTT_START_QUEUE_CONNECT;
3139  bf5e 350400a8      	mov	_mqtt_start,#4
3142  bf62 81            	ret	
3143  bf63               L5571:
3144                     ; 739     else if (mqtt_start_ctr1 > 150) {
3146  bf63 c600a6        	ld	a,_mqtt_start_ctr1
3147  bf66 a197          	cp	a,#151
3148  bf68 2403ccc0e9    	jrult	L7371
3149                     ; 742       mqtt_start_status |= MQTT_START_TCP_CONNECT_ERROR;
3151  bf6d 721400a7      	bset	_mqtt_start_status,#2
3152                     ; 743       mqtt_start = MQTT_START_TCP_CONNECT;
3154  bf71 350100a8      	mov	_mqtt_start,#1
3155                     ; 745       mqtt_start_status = MQTT_START_NOT_STARTED; 
3157  bf75 725f00a7      	clr	_mqtt_start_status
3158                     ; 746       mqtt_start_retry++;
3160  bf79 725c00a3      	inc	_mqtt_start_retry
3162  bf7d 81            	ret	
3163  bf7e               L3571:
3164                     ; 750   else if (mqtt_start == MQTT_START_QUEUE_CONNECT) {
3166  bf7e c600a8        	ld	a,_mqtt_start
3167  bf81 a104          	cp	a,#4
3168  bf83 2703ccc00b    	jrne	L5671
3169                     ; 761     strcpy(client_id_text, devicetype);
3171  bf88 ae00a9        	ldw	x,#_client_id_text
3172  bf8b 90ae9e68      	ldw	y,#L5261_devicetype
3173  bf8f               L411:
3174  bf8f 90f6          	ld	a,(y)
3175  bf91 905c          	incw	y
3176  bf93 f7            	ld	(x),a
3177  bf94 5c            	incw	x
3178  bf95 4d            	tnz	a
3179  bf96 26f7          	jrne	L411
3180                     ; 763     client_id_text[strlen(client_id_text) - 1] = '\0';
3182  bf98 ae00a9        	ldw	x,#_client_id_text
3183  bf9b cdf6a8        	call	_strlen
3185  bf9e 5a            	decw	x
3186  bf9f 724f00a9      	clr	(_client_id_text,x)
3187                     ; 765     strcat(client_id_text, mac_string);
3189  bfa3 ae010c        	ldw	x,#_mac_string
3190  bfa6 89            	pushw	x
3191  bfa7 ae00a9        	ldw	x,#_client_id_text
3192  bfaa cdf694        	call	_strcat
3194  bfad 85            	popw	x
3195                     ; 766     client_id = client_id_text;
3197  bfae ae00a9        	ldw	x,#_client_id_text
3198  bfb1 cf00c3        	ldw	_client_id,x
3199                     ; 769     connect_flags = MQTT_CONNECT_CLEAN_SESSION;
3201  bfb4 350200fa      	mov	_connect_flags,#2
3202                     ; 772     topic_base[topic_base_len] = '\0';
3204  bfb8 5f            	clrw	x
3205  bfb9 c60073        	ld	a,_topic_base_len
3206  bfbc 97            	ld	xl,a
3207  bfbd 724f0074      	clr	(_topic_base,x)
3208                     ; 773     strcat(topic_base, "/status");
3210  bfc1 ae9ec1        	ldw	x,#L7671
3211  bfc4 89            	pushw	x
3212  bfc5 ae0074        	ldw	x,#_topic_base
3213  bfc8 cdf694        	call	_strcat
3215  bfcb 85            	popw	x
3216                     ; 776     mqtt_connect(&mqttclient,
3216                     ; 777                  client_id,              // Based on MAC address
3216                     ; 778                  topic_base,             // Will topic
3216                     ; 779                  "offline",              // Will message 
3216                     ; 780                  7,                      // Will message size
3216                     ; 781                  stored_mqtt_username,   // Username
3216                     ; 782                  stored_mqtt_password,   // Password
3216                     ; 783                  connect_flags,          // Connect flags
3216                     ; 784                  mqtt_keep_alive);       // Ping interval
3218  bfcc ce00f1        	ldw	x,_mqtt_keep_alive
3219  bfcf 89            	pushw	x
3220  bfd0 3b00fa        	push	_connect_flags
3221  bfd3 ae4040        	ldw	x,#_stored_mqtt_password
3222  bfd6 89            	pushw	x
3223  bfd7 ae4035        	ldw	x,#_stored_mqtt_username
3224  bfda 89            	pushw	x
3225  bfdb ae0007        	ldw	x,#7
3226  bfde 89            	pushw	x
3227  bfdf ae9eb9        	ldw	x,#L1771
3228  bfe2 89            	pushw	x
3229  bfe3 ae0074        	ldw	x,#_topic_base
3230  bfe6 89            	pushw	x
3231  bfe7 ce00c3        	ldw	x,_client_id
3232  bfea 89            	pushw	x
3233  bfeb ae00c5        	ldw	x,#_mqttclient
3234  bfee cdd088        	call	_mqtt_connect
3236  bff1 5b0f          	addw	sp,#15
3237                     ; 786     if (mqttclient.error == MQTT_OK) {
3239  bff3 ce00cf        	ldw	x,_mqttclient+10
3240  bff6 5a            	decw	x
3241  bff7 260d          	jrne	L3771
3242                     ; 787       mqtt_start_ctr1 = 0; // Clear 100ms counter
3244  bff9 725f00a6      	clr	_mqtt_start_ctr1
3245                     ; 788       mqtt_start_status |= MQTT_START_MQTT_CONNECT_GOOD;
3247  bffd 721e00a7      	bset	_mqtt_start_status,#7
3248                     ; 789       mqtt_start = MQTT_START_QUEUE_SUBSCRIBE1;
3250  c001 350500a8      	mov	_mqtt_start,#5
3253  c005 81            	ret	
3254  c006               L3771:
3255                     ; 792       mqtt_start_status |= MQTT_START_MQTT_CONNECT_ERROR;
3257  c006 721600a7      	bset	_mqtt_start_status,#3
3259  c00a 81            	ret	
3260  c00b               L5671:
3261                     ; 796   else if (mqtt_start == MQTT_START_QUEUE_SUBSCRIBE1) {
3263  c00b a105          	cp	a,#5
3264  c00d 2635          	jrne	L1002
3265                     ; 806     if (mqtt_start_ctr1 > 20) {
3267  c00f c600a6        	ld	a,_mqtt_start_ctr1
3268  c012 a115          	cp	a,#21
3269  c014 2403ccc0e9    	jrult	L7371
3270                     ; 817       topic_base[topic_base_len] = '\0';
3272  c019 c60073        	ld	a,_topic_base_len
3273  c01c 5f            	clrw	x
3274  c01d 97            	ld	xl,a
3275  c01e 724f0074      	clr	(_topic_base,x)
3276                     ; 818       strcat(topic_base, "/on");
3278  c022 ae9eb5        	ldw	x,#L5002
3279  c025 89            	pushw	x
3280  c026 ae0074        	ldw	x,#_topic_base
3281  c029 cdf694        	call	_strcat
3283  c02c 85            	popw	x
3284                     ; 819       mqtt_subscribe(&mqttclient, topic_base, 0);
3286  c02d 5f            	clrw	x
3287  c02e 89            	pushw	x
3288  c02f ae0074        	ldw	x,#_topic_base
3289  c032 89            	pushw	x
3290  c033 ae00c5        	ldw	x,#_mqttclient
3291  c036 cdd397        	call	_mqtt_subscribe
3293  c039 5b04          	addw	sp,#4
3294                     ; 820       mqtt_start_ctr1 = 0; // Clear 100ms counter
3296  c03b 725f00a6      	clr	_mqtt_start_ctr1
3297                     ; 821       mqtt_start = MQTT_START_QUEUE_SUBSCRIBE2;
3299  c03f 350600a8      	mov	_mqtt_start,#6
3301  c043 81            	ret	
3302  c044               L1002:
3303                     ; 825   else if (mqtt_start == MQTT_START_QUEUE_SUBSCRIBE2) {
3305  c044 a106          	cp	a,#6
3306  c046 2632          	jrne	L1102
3307                     ; 826     if (mqtt_start_ctr1 > 10) {
3309  c048 c600a6        	ld	a,_mqtt_start_ctr1
3310  c04b a10b          	cp	a,#11
3311  c04d 25c7          	jrult	L7371
3312                     ; 829       topic_base[topic_base_len] = '\0';
3314  c04f c60073        	ld	a,_topic_base_len
3315  c052 5f            	clrw	x
3316  c053 97            	ld	xl,a
3317  c054 724f0074      	clr	(_topic_base,x)
3318                     ; 830       strcat(topic_base, "/off");
3320  c058 ae9eb0        	ldw	x,#L5102
3321  c05b 89            	pushw	x
3322  c05c ae0074        	ldw	x,#_topic_base
3323  c05f cdf694        	call	_strcat
3325  c062 85            	popw	x
3326                     ; 831       mqtt_subscribe(&mqttclient, topic_base, 0);
3328  c063 5f            	clrw	x
3329  c064 89            	pushw	x
3330  c065 ae0074        	ldw	x,#_topic_base
3331  c068 89            	pushw	x
3332  c069 ae00c5        	ldw	x,#_mqttclient
3333  c06c cdd397        	call	_mqtt_subscribe
3335  c06f 5b04          	addw	sp,#4
3336                     ; 832       mqtt_start_ctr1 = 0; // Clear 100ms counter
3338  c071 725f00a6      	clr	_mqtt_start_ctr1
3339                     ; 833       mqtt_start = MQTT_START_QUEUE_SUBSCRIBE3;
3341  c075 350700a8      	mov	_mqtt_start,#7
3343  c079 81            	ret	
3344  c07a               L1102:
3345                     ; 837   else if (mqtt_start == MQTT_START_QUEUE_SUBSCRIBE3) {
3347  c07a a107          	cp	a,#7
3348  c07c 2632          	jrne	L1202
3349                     ; 838     if (mqtt_start_ctr1 > 10) {
3351  c07e c600a6        	ld	a,_mqtt_start_ctr1
3352  c081 a10b          	cp	a,#11
3353  c083 2564          	jrult	L7371
3354                     ; 841       topic_base[topic_base_len] = '\0';
3356  c085 c60073        	ld	a,_topic_base_len
3357  c088 5f            	clrw	x
3358  c089 97            	ld	xl,a
3359  c08a 724f0074      	clr	(_topic_base,x)
3360                     ; 842       strcat(topic_base, "/state-req");
3362  c08e ae9ea5        	ldw	x,#L5202
3363  c091 89            	pushw	x
3364  c092 ae0074        	ldw	x,#_topic_base
3365  c095 cdf694        	call	_strcat
3367  c098 85            	popw	x
3368                     ; 843       mqtt_subscribe(&mqttclient, topic_base, 0);
3370  c099 5f            	clrw	x
3371  c09a 89            	pushw	x
3372  c09b ae0074        	ldw	x,#_topic_base
3373  c09e 89            	pushw	x
3374  c09f ae00c5        	ldw	x,#_mqttclient
3375  c0a2 cdd397        	call	_mqtt_subscribe
3377  c0a5 5b04          	addw	sp,#4
3378                     ; 844       mqtt_start_ctr1 = 0; // Clear 100ms counter
3380  c0a7 725f00a6      	clr	_mqtt_start_ctr1
3381                     ; 845       mqtt_start = MQTT_START_QUEUE_PUBLISH;
3383  c0ab 350900a8      	mov	_mqtt_start,#9
3385  c0af 81            	ret	
3386  c0b0               L1202:
3387                     ; 849   else if (mqtt_start == MQTT_START_QUEUE_PUBLISH) {
3389  c0b0 a109          	cp	a,#9
3390  c0b2 2635          	jrne	L7371
3391                     ; 850     if (mqtt_start_ctr1 > 10) {
3393  c0b4 c600a6        	ld	a,_mqtt_start_ctr1
3394  c0b7 a10b          	cp	a,#11
3395  c0b9 252e          	jrult	L7371
3396                     ; 853       topic_base[topic_base_len] = '\0';
3398  c0bb c60073        	ld	a,_topic_base_len
3399  c0be 5f            	clrw	x
3400  c0bf 97            	ld	xl,a
3401  c0c0 724f0074      	clr	(_topic_base,x)
3402                     ; 854       strcat(topic_base, "/status");
3404  c0c4 ae9ec1        	ldw	x,#L7671
3405  c0c7 89            	pushw	x
3406  c0c8 ae0074        	ldw	x,#_topic_base
3407  c0cb cdf694        	call	_strcat
3409  c0ce 85            	popw	x
3410                     ; 855       mqtt_publish(&mqttclient,
3410                     ; 856                    topic_base,
3410                     ; 857 		   "online",
3410                     ; 858 		   6,
3410                     ; 859 		   MQTT_PUBLISH_QOS_0 | MQTT_PUBLISH_RETAIN);
3412  c0cf 4b01          	push	#1
3413  c0d1 ae0006        	ldw	x,#6
3414  c0d4 89            	pushw	x
3415  c0d5 ae9e9e        	ldw	x,#L5302
3416  c0d8 89            	pushw	x
3417  c0d9 ae0074        	ldw	x,#_topic_base
3418  c0dc 89            	pushw	x
3419  c0dd ae00c5        	ldw	x,#_mqttclient
3420  c0e0 cdd132        	call	_mqtt_publish
3422  c0e3 5b07          	addw	sp,#7
3423                     ; 861       mqtt_start = MQTT_START_COMPLETE;
3425  c0e5 351400a8      	mov	_mqtt_start,#20
3426  c0e9               L7371:
3427                     ; 864 }
3430  c0e9 81            	ret	
3466                     ; 867 void mqtt_sanity_check(void)
3466                     ; 868 {
3467                     .text:	section	.text,new
3468  c0ea               _mqtt_sanity_check:
3472                     ; 880   if (mqtt_restart_step == MQTT_RESTART_IDLE) {
3474  c0ea c600a0        	ld	a,_mqtt_restart_step
3475  c0ed 2634          	jrne	L7402
3476                     ; 887     if (mqttclient.number_of_timeouts > 1) {
3478  c0ef ce00d3        	ldw	x,_mqttclient+14
3479  c0f2 a30002        	cpw	x,#2
3480  c0f5 2f08          	jrslt	L1502
3481                     ; 889       mqttclient.number_of_timeouts = 0;
3483  c0f7 5f            	clrw	x
3484  c0f8 cf00d3        	ldw	_mqttclient+14,x
3485                     ; 890       mqtt_restart_step = MQTT_RESTART_BEGIN;
3487  c0fb 350100a0      	mov	_mqtt_restart_step,#1
3488  c0ff               L1502:
3489                     ; 896     if (mqtt_start == MQTT_START_COMPLETE
3489                     ; 897      && mqtt_conn->tcpstateflags == UIP_CLOSED) {
3491  c0ff c600a8        	ld	a,_mqtt_start
3492  c102 a114          	cp	a,#20
3493  c104 260b          	jrne	L3502
3495  c106 ce00a1        	ldw	x,_mqtt_conn
3496  c109 6d19          	tnz	(25,x)
3497  c10b 2604          	jrne	L3502
3498                     ; 898       mqtt_restart_step = MQTT_RESTART_BEGIN;
3500  c10d 350100a0      	mov	_mqtt_restart_step,#1
3501  c111               L3502:
3502                     ; 904     if (mqtt_start == MQTT_START_COMPLETE
3502                     ; 905      && mqttclient.error != MQTT_OK) {
3504  c111 a114          	cp	a,#20
3505  c113 2703ccc1a0    	jrne	L7502
3507  c118 ce00cf        	ldw	x,_mqttclient+10
3508  c11b 5a            	decw	x
3509  c11c 27f7          	jreq	L7502
3510                     ; 906       mqtt_restart_step = MQTT_RESTART_BEGIN;
3512  c11e 350100a0      	mov	_mqtt_restart_step,#1
3514  c122 81            	ret	
3515  c123               L7402:
3516                     ; 910   else if (mqtt_restart_step == MQTT_RESTART_BEGIN) {
3518  c123 a101          	cp	a,#1
3519  c125 2609          	jrne	L1602
3520                     ; 918     mqtt_restart_step = MQTT_RESTART_DISCONNECT_START;
3522  c127 350200a0      	mov	_mqtt_restart_step,#2
3523                     ; 921     mqtt_start_status = MQTT_START_NOT_STARTED;
3525  c12b 725f00a7      	clr	_mqtt_start_status
3528  c12f 81            	ret	
3529  c130               L1602:
3530                     ; 924   else if (mqtt_restart_step == MQTT_RESTART_DISCONNECT_START) {
3532  c130 a102          	cp	a,#2
3533  c132 260f          	jrne	L5602
3534                     ; 925     mqtt_restart_step = MQTT_RESTART_DISCONNECT_WAIT;
3536  c134 350300a0      	mov	_mqtt_restart_step,#3
3537                     ; 927     mqtt_disconnect(&mqttclient);
3539  c138 ae00c5        	ldw	x,#_mqttclient
3540  c13b cdd483        	call	_mqtt_disconnect
3542                     ; 928     mqtt_sanity_ctr = 0; // Clear 100ms counter
3544  c13e 725f00a4      	clr	_mqtt_sanity_ctr
3547  c142 81            	ret	
3548  c143               L5602:
3549                     ; 931   else if (mqtt_restart_step == MQTT_RESTART_DISCONNECT_WAIT) {
3551  c143 a103          	cp	a,#3
3552  c145 260c          	jrne	L1702
3553                     ; 932     if (mqtt_sanity_ctr > 10) {
3555  c147 c600a4        	ld	a,_mqtt_sanity_ctr
3556  c14a a10b          	cp	a,#11
3557  c14c 2552          	jrult	L7502
3558                     ; 935       mqtt_restart_step = MQTT_RESTART_TCPCLOSE;
3560  c14e 350400a0      	mov	_mqtt_restart_step,#4
3562  c152 81            	ret	
3563  c153               L1702:
3564                     ; 939   else if (mqtt_restart_step == MQTT_RESTART_TCPCLOSE) {
3566  c153 a104          	cp	a,#4
3567  c155 260d          	jrne	L7702
3568                     ; 955     mqtt_close_tcp = 1;
3570  c157 35010107      	mov	_mqtt_close_tcp,#1
3571                     ; 957     mqtt_sanity_ctr = 0; // Clear 100ms counter
3573  c15b 725f00a4      	clr	_mqtt_sanity_ctr
3574                     ; 958     mqtt_restart_step = MQTT_RESTART_TCPCLOSE_WAIT;
3576  c15f 350500a0      	mov	_mqtt_restart_step,#5
3579  c163 81            	ret	
3580  c164               L7702:
3581                     ; 961   else if (mqtt_restart_step == MQTT_RESTART_TCPCLOSE_WAIT) {
3583  c164 a105          	cp	a,#5
3584  c166 2610          	jrne	L3012
3585                     ; 966     if (mqtt_sanity_ctr > 20) {
3587  c168 c600a4        	ld	a,_mqtt_sanity_ctr
3588  c16b a115          	cp	a,#21
3589  c16d 2531          	jrult	L7502
3590                     ; 967       mqtt_close_tcp = 0;
3592  c16f 725f0107      	clr	_mqtt_close_tcp
3593                     ; 968       mqtt_restart_step = MQTT_RESTART_SIGNAL_STARTUP;
3595  c173 350600a0      	mov	_mqtt_restart_step,#6
3597  c177 81            	ret	
3598  c178               L3012:
3599                     ; 972   else if (mqtt_restart_step == MQTT_RESTART_SIGNAL_STARTUP) {
3601  c178 a106          	cp	a,#6
3602  c17a 2624          	jrne	L7502
3603                     ; 974     mqtt_init(&mqttclient,
3603                     ; 975               mqtt_sendbuf,
3603                     ; 976 	      sizeof(mqtt_sendbuf),
3603                     ; 977 	      &uip_buf[UIP_IPTCPH_LEN + UIP_LLH_LEN],
3603                     ; 978 	      UIP_APPDATA_SIZE,
3603                     ; 979 	      publish_callback);
3605  c17c aec1a1        	ldw	x,#_publish_callback
3606  c17f 89            	pushw	x
3607  c180 ae01be        	ldw	x,#446
3608  c183 89            	pushw	x
3609  c184 ae03a9        	ldw	x,#_uip_buf+54
3610  c187 89            	pushw	x
3611  c188 ae00c8        	ldw	x,#200
3612  c18b 89            	pushw	x
3613  c18c ae016f        	ldw	x,#_mqtt_sendbuf
3614  c18f 89            	pushw	x
3615  c190 ae00c5        	ldw	x,#_mqttclient
3616  c193 cdd030        	call	_mqtt_init
3618  c196 5b0a          	addw	sp,#10
3619                     ; 982     mqtt_restart_step = MQTT_RESTART_IDLE;
3621  c198 725f00a0      	clr	_mqtt_restart_step
3622                     ; 983     mqtt_start = MQTT_START_TCP_CONNECT;
3624  c19c 350100a8      	mov	_mqtt_start,#1
3625  c1a0               L7502:
3626                     ; 985 }
3629  c1a0 81            	ret	
3702                     ; 1063 void publish_callback(void** unused, struct mqtt_response_publish *published)
3702                     ; 1064 {
3703                     .text:	section	.text,new
3704  c1a1               _publish_callback:
3706  c1a1 5204          	subw	sp,#4
3707       00000004      OFST:	set	4
3710                     ; 1070   pin_value = 0;
3712  c1a3 0f01          	clr	(OFST-3,sp)
3714                     ; 1071   ParseNum = 0;
3716                     ; 1099   pBuffer = uip_appdata;
3718  c1a5 ce0371        	ldw	x,_uip_appdata
3720                     ; 1101   pBuffer = pBuffer + 1;
3722  c1a8 1c0012        	addw	x,#18
3724                     ; 1103   pBuffer = pBuffer + 1;
3727                     ; 1105   pBuffer = pBuffer + 2;
3730                     ; 1107   pBuffer = pBuffer + 14;
3732  c1ab 1f03          	ldw	(OFST-1,sp),x
3734                     ; 1109   pBuffer = pBuffer + strlen(stored_devicename) + 1;
3736  c1ad ae4000        	ldw	x,#_stored_devicename
3737  c1b0 cdf6a8        	call	_strlen
3739  c1b3 72fb03        	addw	x,(OFST-1,sp)
3740  c1b6 5c            	incw	x
3741  c1b7 1f03          	ldw	(OFST-1,sp),x
3743                     ; 1112   if (*pBuffer == 'o') {
3745  c1b9 f6            	ld	a,(x)
3746  c1ba a16f          	cp	a,#111
3747  c1bc 267a          	jrne	L3412
3748                     ; 1113     pBuffer++;
3750  c1be 5c            	incw	x
3751  c1bf 1f03          	ldw	(OFST-1,sp),x
3753                     ; 1114     if (*pBuffer == 'n') {
3755  c1c1 f6            	ld	a,(x)
3756  c1c2 a16e          	cp	a,#110
3757  c1c4 2609          	jrne	L5412
3758                     ; 1115       pBuffer++;
3760  c1c6 5c            	incw	x
3761  c1c7 1f03          	ldw	(OFST-1,sp),x
3763                     ; 1116       pin_value = 1;
3765  c1c9 a601          	ld	a,#1
3766  c1cb 6b01          	ld	(OFST-3,sp),a
3769  c1cd 200b          	jra	L7412
3770  c1cf               L5412:
3771                     ; 1118     else if (*pBuffer == 'f') {
3773  c1cf a166          	cp	a,#102
3774  c1d1 2607          	jrne	L7412
3775                     ; 1119       pBuffer = pBuffer + 2;
3777  c1d3 1c0002        	addw	x,#2
3778  c1d6 1f03          	ldw	(OFST-1,sp),x
3780                     ; 1120       pin_value = 0;
3782  c1d8 0f01          	clr	(OFST-3,sp)
3784  c1da               L7412:
3785                     ; 1124     if (*pBuffer == 'a') {
3787  c1da f6            	ld	a,(x)
3788  c1db a161          	cp	a,#97
3789  c1dd 2625          	jrne	L3512
3790                     ; 1125       pBuffer++;
3792  c1df 5c            	incw	x
3793  c1e0 1f03          	ldw	(OFST-1,sp),x
3795                     ; 1126       if (*pBuffer == 'l') {
3797  c1e2 f6            	ld	a,(x)
3798  c1e3 a16c          	cp	a,#108
3799  c1e5 264b          	jrne	L7612
3800                     ; 1127         pBuffer++;
3802  c1e7 5c            	incw	x
3803  c1e8 1f03          	ldw	(OFST-1,sp),x
3805                     ; 1128         if (*pBuffer == 'l') {
3807  c1ea f6            	ld	a,(x)
3808  c1eb a16c          	cp	a,#108
3809  c1ed 2643          	jrne	L7612
3810                     ; 1130 	  for (i=0; i<8; i++) GpioSetPin(i, (uint8_t)pin_value);
3812  c1ef 0f02          	clr	(OFST-2,sp)
3814  c1f1               L1612:
3817  c1f1 7b01          	ld	a,(OFST-3,sp)
3818  c1f3 97            	ld	xl,a
3819  c1f4 7b02          	ld	a,(OFST-2,sp)
3820  c1f6 95            	ld	xh,a
3821  c1f7 cdbc60        	call	_GpioSetPin
3825  c1fa 0c02          	inc	(OFST-2,sp)
3829  c1fc 7b02          	ld	a,(OFST-2,sp)
3830  c1fe a108          	cp	a,#8
3831  c200 25ef          	jrult	L1612
3832  c202 202e          	jra	L7612
3833  c204               L3512:
3834                     ; 1136     else if (*pBuffer == '0' || *pBuffer == '1') {
3836  c204 a130          	cp	a,#48
3837  c206 2704          	jreq	L3712
3839  c208 a131          	cp	a,#49
3840  c20a 2626          	jrne	L7612
3841  c20c               L3712:
3842                     ; 1138       ParseNum = (uint8_t)((*pBuffer - '0') * 10);
3844  c20c 97            	ld	xl,a
3845  c20d a60a          	ld	a,#10
3846  c20f 42            	mul	x,a
3847  c210 9f            	ld	a,xl
3848  c211 a0e0          	sub	a,#224
3849  c213 6b02          	ld	(OFST-2,sp),a
3851                     ; 1139       pBuffer++;
3853  c215 1e03          	ldw	x,(OFST-1,sp)
3854  c217 5c            	incw	x
3855  c218 1f03          	ldw	(OFST-1,sp),x
3857                     ; 1141       ParseNum += (uint8_t)(*pBuffer - '0');
3859  c21a f6            	ld	a,(x)
3860  c21b a030          	sub	a,#48
3861  c21d 1b02          	add	a,(OFST-2,sp)
3862  c21f 6b02          	ld	(OFST-2,sp),a
3864                     ; 1143       if (ParseNum > 0 && ParseNum < 9) {
3866  c221 270f          	jreq	L7612
3868  c223 a109          	cp	a,#9
3869  c225 240b          	jruge	L7612
3870                     ; 1145         ParseNum--;
3872  c227 0a02          	dec	(OFST-2,sp)
3874                     ; 1147         GpioSetPin(ParseNum, (uint8_t)pin_value);
3876  c229 7b01          	ld	a,(OFST-3,sp)
3877  c22b 97            	ld	xl,a
3878  c22c 7b02          	ld	a,(OFST-2,sp)
3879  c22e 95            	ld	xh,a
3880  c22f cdbc60        	call	_GpioSetPin
3882  c232               L7612:
3883                     ; 1153     mqtt_parse_complete = 1;
3885  c232 35010105      	mov	_mqtt_parse_complete,#1
3887  c236 2013          	jra	L7712
3888  c238               L3412:
3889                     ; 1157   else if (*pBuffer == 's') {
3891  c238 a173          	cp	a,#115
3892  c23a 260f          	jrne	L7712
3893                     ; 1158     pBuffer += 8;
3895  c23c 1c0008        	addw	x,#8
3897                     ; 1159     if (*pBuffer == 'q') {
3899  c23f f6            	ld	a,(x)
3900  c240 a171          	cp	a,#113
3901  c242 2607          	jrne	L7712
3902                     ; 1160       *pBuffer = '0'; // Destroy 'q' in buffer so subsequent "state"
3904  c244 a630          	ld	a,#48
3905  c246 f7            	ld	(x),a
3906                     ; 1171       state_request = STATE_REQUEST_RCVD;
3908  c247 35010164      	mov	_state_request,#1
3909  c24b               L7712:
3910                     ; 1174 }
3913  c24b 5b04          	addw	sp,#4
3914  c24d 81            	ret	
3953                     ; 1177 void publish_outbound(void)
3953                     ; 1178 {
3954                     .text:	section	.text,new
3955  c24e               _publish_outbound:
3957  c24e 88            	push	a
3958       00000001      OFST:	set	1
3961                     ; 1210   if (state_request == STATE_REQUEST_IDLE) {
3963  c24f c60164        	ld	a,_state_request
3964  c252 2703ccc347    	jrne	L1222
3965                     ; 1213     xor_tmp = (uint8_t)(IO_16to9 ^ IO_16to9_sent);
3967  c257 c6016e        	ld	a,_IO_16to9
3968  c25a c80168        	xor	a,_IO_16to9_sent
3969  c25d 6b01          	ld	(OFST+0,sp),a
3971                     ; 1215     if      (xor_tmp & 0x80) publish_pinstate('I', '8', IO_16to9, 0x80); // Input 8
3973  c25f 2a0a          	jrpl	L3222
3976  c261 4b80          	push	#128
3977  c263 3b016e        	push	_IO_16to9
3978  c266 ae4938        	ldw	x,#18744
3981  c269 2060          	jp	LC002
3982  c26b               L3222:
3983                     ; 1216     else if (xor_tmp & 0x40) publish_pinstate('I', '7', IO_16to9, 0x40); // Input 7
3985  c26b a540          	bcp	a,#64
3986  c26d 270a          	jreq	L7222
3989  c26f 4b40          	push	#64
3990  c271 3b016e        	push	_IO_16to9
3991  c274 ae4937        	ldw	x,#18743
3994  c277 2052          	jp	LC002
3995  c279               L7222:
3996                     ; 1217     else if (xor_tmp & 0x20) publish_pinstate('I', '6', IO_16to9, 0x20); // Input 6
3998  c279 a520          	bcp	a,#32
3999  c27b 270a          	jreq	L3322
4002  c27d 4b20          	push	#32
4003  c27f 3b016e        	push	_IO_16to9
4004  c282 ae4936        	ldw	x,#18742
4007  c285 2044          	jp	LC002
4008  c287               L3322:
4009                     ; 1218     else if (xor_tmp & 0x10) publish_pinstate('I', '5', IO_16to9, 0x10); // Input 5
4011  c287 a510          	bcp	a,#16
4012  c289 270a          	jreq	L7322
4015  c28b 4b10          	push	#16
4016  c28d 3b016e        	push	_IO_16to9
4017  c290 ae4935        	ldw	x,#18741
4020  c293 2036          	jp	LC002
4021  c295               L7322:
4022                     ; 1219     else if (xor_tmp & 0x08) publish_pinstate('I', '4', IO_16to9, 0x08); // Input 4
4024  c295 a508          	bcp	a,#8
4025  c297 270a          	jreq	L3422
4028  c299 4b08          	push	#8
4029  c29b 3b016e        	push	_IO_16to9
4030  c29e ae4934        	ldw	x,#18740
4033  c2a1 2028          	jp	LC002
4034  c2a3               L3422:
4035                     ; 1220     else if (xor_tmp & 0x04) publish_pinstate('I', '3', IO_16to9, 0x04); // Input 3
4037  c2a3 a504          	bcp	a,#4
4038  c2a5 270a          	jreq	L7422
4041  c2a7 4b04          	push	#4
4042  c2a9 3b016e        	push	_IO_16to9
4043  c2ac ae4933        	ldw	x,#18739
4046  c2af 201a          	jp	LC002
4047  c2b1               L7422:
4048                     ; 1221     else if (xor_tmp & 0x02) publish_pinstate('I', '2', IO_16to9, 0x02); // Input 2
4050  c2b1 a502          	bcp	a,#2
4051  c2b3 270a          	jreq	L3522
4054  c2b5 4b02          	push	#2
4055  c2b7 3b016e        	push	_IO_16to9
4056  c2ba ae4932        	ldw	x,#18738
4059  c2bd 200c          	jp	LC002
4060  c2bf               L3522:
4061                     ; 1222     else if (xor_tmp & 0x01) publish_pinstate('I', '1', IO_16to9, 0x01); // Input 1
4063  c2bf a501          	bcp	a,#1
4064  c2c1 270c          	jreq	L5222
4067  c2c3 4b01          	push	#1
4068  c2c5 3b016e        	push	_IO_16to9
4069  c2c8 ae4931        	ldw	x,#18737
4071  c2cb               LC002:
4072  c2cb cdc355        	call	_publish_pinstate
4073  c2ce 85            	popw	x
4074  c2cf               L5222:
4075                     ; 1226     xor_tmp = (uint8_t)(IO_8to1 ^ IO_8to1_sent);
4077  c2cf c6016d        	ld	a,_IO_8to1
4078  c2d2 c80167        	xor	a,_IO_8to1_sent
4079  c2d5 6b01          	ld	(OFST+0,sp),a
4081                     ; 1228     if      (xor_tmp & 0x80) publish_pinstate('O', '8', IO_8to1, 0x80); // Output 8
4083  c2d7 2a0a          	jrpl	L1622
4086  c2d9 4b80          	push	#128
4087  c2db 3b016d        	push	_IO_8to1
4088  c2de ae4f38        	ldw	x,#20280
4091  c2e1 2060          	jp	LC003
4092  c2e3               L1622:
4093                     ; 1229     else if (xor_tmp & 0x40) publish_pinstate('O', '7', IO_8to1, 0x40); // Output 7
4095  c2e3 a540          	bcp	a,#64
4096  c2e5 270a          	jreq	L5622
4099  c2e7 4b40          	push	#64
4100  c2e9 3b016d        	push	_IO_8to1
4101  c2ec ae4f37        	ldw	x,#20279
4104  c2ef 2052          	jp	LC003
4105  c2f1               L5622:
4106                     ; 1230     else if (xor_tmp & 0x20) publish_pinstate('O', '6', IO_8to1, 0x20); // Output 6
4108  c2f1 a520          	bcp	a,#32
4109  c2f3 270a          	jreq	L1722
4112  c2f5 4b20          	push	#32
4113  c2f7 3b016d        	push	_IO_8to1
4114  c2fa ae4f36        	ldw	x,#20278
4117  c2fd 2044          	jp	LC003
4118  c2ff               L1722:
4119                     ; 1231     else if (xor_tmp & 0x10) publish_pinstate('O', '5', IO_8to1, 0x10); // Output 5
4121  c2ff a510          	bcp	a,#16
4122  c301 270a          	jreq	L5722
4125  c303 4b10          	push	#16
4126  c305 3b016d        	push	_IO_8to1
4127  c308 ae4f35        	ldw	x,#20277
4130  c30b 2036          	jp	LC003
4131  c30d               L5722:
4132                     ; 1232     else if (xor_tmp & 0x08) publish_pinstate('O', '4', IO_8to1, 0x08); // Output 4
4134  c30d a508          	bcp	a,#8
4135  c30f 270a          	jreq	L1032
4138  c311 4b08          	push	#8
4139  c313 3b016d        	push	_IO_8to1
4140  c316 ae4f34        	ldw	x,#20276
4143  c319 2028          	jp	LC003
4144  c31b               L1032:
4145                     ; 1233     else if (xor_tmp & 0x04) publish_pinstate('O', '3', IO_8to1, 0x04); // Output 3
4147  c31b a504          	bcp	a,#4
4148  c31d 270a          	jreq	L5032
4151  c31f 4b04          	push	#4
4152  c321 3b016d        	push	_IO_8to1
4153  c324 ae4f33        	ldw	x,#20275
4156  c327 201a          	jp	LC003
4157  c329               L5032:
4158                     ; 1234     else if (xor_tmp & 0x02) publish_pinstate('O', '2', IO_8to1, 0x02); // Output 2
4160  c329 a502          	bcp	a,#2
4161  c32b 270a          	jreq	L1132
4164  c32d 4b02          	push	#2
4165  c32f 3b016d        	push	_IO_8to1
4166  c332 ae4f32        	ldw	x,#20274
4169  c335 200c          	jp	LC003
4170  c337               L1132:
4171                     ; 1235     else if (xor_tmp & 0x01) publish_pinstate('O', '1', IO_8to1, 0x01); // Output 1
4173  c337 a501          	bcp	a,#1
4174  c339 270c          	jreq	L1222
4177  c33b 4b01          	push	#1
4178  c33d 3b016d        	push	_IO_8to1
4179  c340 ae4f31        	ldw	x,#20273
4181  c343               LC003:
4182  c343 cdc355        	call	_publish_pinstate
4183  c346 85            	popw	x
4184  c347               L1222:
4185                     ; 1239   if (state_request == STATE_REQUEST_RCVD) {
4187  c347 c60164        	ld	a,_state_request
4188  c34a 4a            	dec	a
4189  c34b 2606          	jrne	L7132
4190                     ; 1241     state_request = STATE_REQUEST_IDLE;
4192  c34d c70164        	ld	_state_request,a
4193                     ; 1242     publish_pinstate_all();
4195  c350 cdc3ed        	call	_publish_pinstate_all
4197  c353               L7132:
4198                     ; 1244 }
4201  c353 84            	pop	a
4202  c354 81            	ret	
4266                     ; 1247 void publish_pinstate(uint8_t direction, uint8_t pin, uint8_t value, uint8_t mask)
4266                     ; 1248 {
4267                     .text:	section	.text,new
4268  c355               _publish_pinstate:
4270  c355 89            	pushw	x
4271       00000000      OFST:	set	0
4274                     ; 1251   application_message[0] = '0';
4276  c356 353000f3      	mov	_application_message,#48
4277                     ; 1252   application_message[1] = (uint8_t)(pin);
4279  c35a 9f            	ld	a,xl
4280  c35b c700f4        	ld	_application_message+1,a
4281                     ; 1253   application_message[2] = '\0';
4283  c35e 725f00f5      	clr	_application_message+2
4284                     ; 1255   topic_base[topic_base_len] = '\0';
4286  c362 5f            	clrw	x
4287  c363 c60073        	ld	a,_topic_base_len
4288  c366 97            	ld	xl,a
4289  c367 724f0074      	clr	(_topic_base,x)
4290                     ; 1258   if (direction == 'I') {
4292  c36b 7b01          	ld	a,(OFST+1,sp)
4293  c36d a149          	cp	a,#73
4294  c36f 2618          	jrne	L3432
4295                     ; 1260     if (invert_input == 0xff) value = (uint8_t)(~value);
4297  c371 c60165        	ld	a,_invert_input
4298  c374 4c            	inc	a
4299  c375 2602          	jrne	L5432
4302  c377 0305          	cpl	(OFST+5,sp)
4303  c379               L5432:
4304                     ; 1261     if (value & mask) strcat(topic_base, "/in_on");
4306  c379 7b05          	ld	a,(OFST+5,sp)
4307  c37b 1506          	bcp	a,(OFST+6,sp)
4308  c37d 2705          	jreq	L7432
4311  c37f ae9e97        	ldw	x,#L1532
4314  c382 2013          	jra	L7532
4315  c384               L7432:
4316                     ; 1262     else strcat(topic_base, "/in_off");
4318  c384 ae9e8f        	ldw	x,#L5532
4320  c387 200e          	jra	L7532
4321  c389               L3432:
4322                     ; 1266     if (value & mask) strcat(topic_base, "/out_on");
4324  c389 7b05          	ld	a,(OFST+5,sp)
4325  c38b 1506          	bcp	a,(OFST+6,sp)
4326  c38d 2705          	jreq	L1632
4329  c38f ae9e87        	ldw	x,#L3632
4332  c392 2003          	jra	L7532
4333  c394               L1632:
4334                     ; 1267     else strcat(topic_base, "/out_off");
4336  c394 ae9e7e        	ldw	x,#L7632
4338  c397               L7532:
4339  c397 89            	pushw	x
4340  c398 ae0074        	ldw	x,#_topic_base
4341  c39b cdf694        	call	_strcat
4342  c39e 85            	popw	x
4343                     ; 1271   mqtt_publish(&mqttclient,
4343                     ; 1272                topic_base,
4343                     ; 1273 	       application_message,
4343                     ; 1274 	       2,
4343                     ; 1275 	       MQTT_PUBLISH_QOS_0);
4345  c39f 4b00          	push	#0
4346  c3a1 ae0002        	ldw	x,#2
4347  c3a4 89            	pushw	x
4348  c3a5 ae00f3        	ldw	x,#_application_message
4349  c3a8 89            	pushw	x
4350  c3a9 ae0074        	ldw	x,#_topic_base
4351  c3ac 89            	pushw	x
4352  c3ad ae00c5        	ldw	x,#_mqttclient
4353  c3b0 cdd132        	call	_mqtt_publish
4355  c3b3 5b07          	addw	sp,#7
4356                     ; 1277   if (direction == 'I') {
4358  c3b5 7b01          	ld	a,(OFST+1,sp)
4359  c3b7 a149          	cp	a,#73
4360  c3b9 2619          	jrne	L1732
4361                     ; 1279     if (IO_16to9 & mask) IO_16to9_sent |= mask;
4363  c3bb c6016e        	ld	a,_IO_16to9
4364  c3be 1506          	bcp	a,(OFST+6,sp)
4365  c3c0 2707          	jreq	L3732
4368  c3c2 c60168        	ld	a,_IO_16to9_sent
4369  c3c5 1a06          	or	a,(OFST+6,sp)
4371  c3c7 2006          	jp	LC005
4372  c3c9               L3732:
4373                     ; 1280     else IO_16to9_sent &= (uint8_t)~mask;
4375  c3c9 7b06          	ld	a,(OFST+6,sp)
4376  c3cb 43            	cpl	a
4377  c3cc c40168        	and	a,_IO_16to9_sent
4378  c3cf               LC005:
4379  c3cf c70168        	ld	_IO_16to9_sent,a
4380  c3d2 2017          	jra	L7732
4381  c3d4               L1732:
4382                     ; 1284     if (IO_8to1 & mask) IO_8to1_sent |= mask;
4384  c3d4 c6016d        	ld	a,_IO_8to1
4385  c3d7 1506          	bcp	a,(OFST+6,sp)
4386  c3d9 2707          	jreq	L1042
4389  c3db c60167        	ld	a,_IO_8to1_sent
4390  c3de 1a06          	or	a,(OFST+6,sp)
4392  c3e0 2006          	jp	LC004
4393  c3e2               L1042:
4394                     ; 1285     else IO_8to1_sent &= (uint8_t)~mask;
4396  c3e2 7b06          	ld	a,(OFST+6,sp)
4397  c3e4 43            	cpl	a
4398  c3e5 c40167        	and	a,_IO_8to1_sent
4399  c3e8               LC004:
4400  c3e8 c70167        	ld	_IO_8to1_sent,a
4401  c3eb               L7732:
4402                     ; 1287 }
4405  c3eb 85            	popw	x
4406  c3ec 81            	ret	
4455                     ; 1290 void publish_pinstate_all(void)
4455                     ; 1291 {
4456                     .text:	section	.text,new
4457  c3ed               _publish_pinstate_all:
4459  c3ed 89            	pushw	x
4460       00000002      OFST:	set	2
4463                     ; 1297   j = IO_16to9;
4465  c3ee c6016e        	ld	a,_IO_16to9
4466  c3f1 6b02          	ld	(OFST+0,sp),a
4468                     ; 1298   k = IO_8to1;
4470  c3f3 c6016d        	ld	a,_IO_8to1
4471  c3f6 6b01          	ld	(OFST-1,sp),a
4473                     ; 1301   if (invert_input == 0xff) j = (uint8_t)(~j);
4475  c3f8 c60165        	ld	a,_invert_input
4476  c3fb 4c            	inc	a
4477  c3fc 2602          	jrne	L3242
4480  c3fe 0302          	cpl	(OFST+0,sp)
4482  c400               L3242:
4483                     ; 1303   application_message[0] = j;
4485  c400 7b02          	ld	a,(OFST+0,sp)
4486  c402 c700f3        	ld	_application_message,a
4487                     ; 1304   application_message[1] = k;
4489  c405 7b01          	ld	a,(OFST-1,sp)
4490  c407 c700f4        	ld	_application_message+1,a
4491                     ; 1305   application_message[2] = '\0';
4493  c40a 725f00f5      	clr	_application_message+2
4494                     ; 1307   topic_base[topic_base_len] = '\0';
4496  c40e 5f            	clrw	x
4497  c40f c60073        	ld	a,_topic_base_len
4498  c412 97            	ld	xl,a
4499  c413 724f0074      	clr	(_topic_base,x)
4500                     ; 1308   strcat(topic_base, "/state");
4502  c417 ae9e77        	ldw	x,#L5242
4503  c41a 89            	pushw	x
4504  c41b ae0074        	ldw	x,#_topic_base
4505  c41e cdf694        	call	_strcat
4507  c421 85            	popw	x
4508                     ; 1311   mqtt_publish(&mqttclient,
4508                     ; 1312                topic_base,
4508                     ; 1313 	       application_message,
4508                     ; 1314 	       2,
4508                     ; 1315 	       MQTT_PUBLISH_QOS_0);
4510  c422 4b00          	push	#0
4511  c424 ae0002        	ldw	x,#2
4512  c427 89            	pushw	x
4513  c428 ae00f3        	ldw	x,#_application_message
4514  c42b 89            	pushw	x
4515  c42c ae0074        	ldw	x,#_topic_base
4516  c42f 89            	pushw	x
4517  c430 ae00c5        	ldw	x,#_mqttclient
4518  c433 cdd132        	call	_mqtt_publish
4520                     ; 1316 }
4523  c436 5b09          	addw	sp,#9
4524  c438 81            	ret	
4549                     ; 1321 void unlock_eeprom(void)
4549                     ; 1322 {
4550                     .text:	section	.text,new
4551  c439               _unlock_eeprom:
4555  c439 2008          	jra	L1442
4556  c43b               L7342:
4557                     ; 1334     FLASH_DUKR = 0xAE; // MASS key 1
4559  c43b 35ae5064      	mov	_FLASH_DUKR,#174
4560                     ; 1335     FLASH_DUKR = 0x56; // MASS key 2
4562  c43f 35565064      	mov	_FLASH_DUKR,#86
4563  c443               L1442:
4564                     ; 1333   while (!(FLASH_IAPSR & 0x08)) {  // Check DUL bit, 0=Protected
4566  c443 7207505ff3    	btjf	_FLASH_IAPSR,#3,L7342
4567                     ; 1363 }
4570  c448 81            	ret	
4655                     ; 1366 void check_eeprom_settings(void)
4655                     ; 1367 {
4656                     .text:	section	.text,new
4657  c449               _check_eeprom_settings:
4659  c449 88            	push	a
4660       00000001      OFST:	set	1
4663                     ; 1379   if ((magic4 == 0x55) && 
4663                     ; 1380       (magic3 == 0xee) && 
4663                     ; 1381       (magic2 == 0x0f) && 
4663                     ; 1382       (magic1 == 0xf0)) {
4665  c44a c6402e        	ld	a,_magic4
4666  c44d a155          	cp	a,#85
4667  c44f 2703ccc5f8    	jrne	L1652
4669  c454 c6402d        	ld	a,_magic3
4670  c457 a1ee          	cp	a,#238
4671  c459 26f6          	jrne	L1652
4673  c45b c6402c        	ld	a,_magic2
4674  c45e a10f          	cp	a,#15
4675  c460 26ef          	jrne	L1652
4677  c462 c6402b        	ld	a,_magic1
4678  c465 a1f0          	cp	a,#240
4679  c467 26e8          	jrne	L1652
4680                     ; 1387     uip_ipaddr(IpAddr, stored_hostaddr[3], stored_hostaddr[2], stored_hostaddr[1], stored_hostaddr[0]);
4682  c469 c6402a        	ld	a,_stored_hostaddr+3
4683  c46c 97            	ld	xl,a
4684  c46d c64029        	ld	a,_stored_hostaddr+2
4685  c470 02            	rlwa	x,a
4686  c471 cf00ff        	ldw	_IpAddr,x
4689  c474 c64028        	ld	a,_stored_hostaddr+1
4690  c477 97            	ld	xl,a
4691  c478 c64027        	ld	a,_stored_hostaddr
4692  c47b 02            	rlwa	x,a
4693  c47c cf0101        	ldw	_IpAddr+2,x
4694                     ; 1388     uip_sethostaddr(IpAddr);
4696  c47f ce00ff        	ldw	x,_IpAddr
4697  c482 cf02c0        	ldw	_uip_hostaddr,x
4700  c485 ce0101        	ldw	x,_IpAddr+2
4701  c488 cf02c2        	ldw	_uip_hostaddr+2,x
4702                     ; 1391     uip_ipaddr(IpAddr,
4704  c48b c64026        	ld	a,_stored_draddr+3
4705  c48e 97            	ld	xl,a
4706  c48f c64025        	ld	a,_stored_draddr+2
4707  c492 02            	rlwa	x,a
4708  c493 cf00ff        	ldw	_IpAddr,x
4711  c496 c64024        	ld	a,_stored_draddr+1
4712  c499 97            	ld	xl,a
4713  c49a c64023        	ld	a,_stored_draddr
4714  c49d 02            	rlwa	x,a
4715  c49e cf0101        	ldw	_IpAddr+2,x
4716                     ; 1396     uip_setdraddr(IpAddr);
4718  c4a1 ce00ff        	ldw	x,_IpAddr
4719  c4a4 cf02b8        	ldw	_uip_draddr,x
4722  c4a7 ce0101        	ldw	x,_IpAddr+2
4723  c4aa cf02ba        	ldw	_uip_draddr+2,x
4724                     ; 1399     uip_ipaddr(IpAddr,
4726  c4ad c64022        	ld	a,_stored_netmask+3
4727  c4b0 97            	ld	xl,a
4728  c4b1 c64021        	ld	a,_stored_netmask+2
4729  c4b4 02            	rlwa	x,a
4730  c4b5 cf00ff        	ldw	_IpAddr,x
4733  c4b8 c64020        	ld	a,_stored_netmask+1
4734  c4bb 97            	ld	xl,a
4735  c4bc c6401f        	ld	a,_stored_netmask
4736  c4bf 02            	rlwa	x,a
4737  c4c0 cf0101        	ldw	_IpAddr+2,x
4738                     ; 1404     uip_setnetmask(IpAddr);
4740  c4c3 ce00ff        	ldw	x,_IpAddr
4741  c4c6 cf02bc        	ldw	_uip_netmask,x
4744  c4c9 ce0101        	ldw	x,_IpAddr+2
4745  c4cc cf02be        	ldw	_uip_netmask+2,x
4746                     ; 1408     uip_ipaddr(IpAddr,
4748  c4cf c64034        	ld	a,_stored_mqttserveraddr+3
4749  c4d2 97            	ld	xl,a
4750  c4d3 c64033        	ld	a,_stored_mqttserveraddr+2
4751  c4d6 02            	rlwa	x,a
4752  c4d7 cf00ff        	ldw	_IpAddr,x
4755  c4da c64032        	ld	a,_stored_mqttserveraddr+1
4756  c4dd 97            	ld	xl,a
4757  c4de c64031        	ld	a,_stored_mqttserveraddr
4758  c4e1 02            	rlwa	x,a
4759  c4e2 cf0101        	ldw	_IpAddr+2,x
4760                     ; 1413     uip_setmqttserveraddr(IpAddr);
4762  c4e5 ce00ff        	ldw	x,_IpAddr
4763  c4e8 cf02b4        	ldw	_uip_mqttserveraddr,x
4766  c4eb ce0101        	ldw	x,_IpAddr+2
4767  c4ee cf02b6        	ldw	_uip_mqttserveraddr+2,x
4768                     ; 1415     Port_Mqttd = stored_mqttport;
4770  c4f1 ce402f        	ldw	x,_stored_mqttport
4771  c4f4 cf00f6        	ldw	_Port_Mqttd,x
4772                     ; 1419     Port_Httpd = stored_port;
4774  c4f7 ce401d        	ldw	x,_stored_port
4775  c4fa cf0103        	ldw	_Port_Httpd,x
4776                     ; 1424     uip_ethaddr.addr[0] = stored_uip_ethaddr_oct[5]; // MSB
4778  c4fd 55401c000a    	mov	_uip_ethaddr,_stored_uip_ethaddr_oct+5
4779                     ; 1425     uip_ethaddr.addr[1] = stored_uip_ethaddr_oct[4];
4781  c502 55401b000b    	mov	_uip_ethaddr+1,_stored_uip_ethaddr_oct+4
4782                     ; 1426     uip_ethaddr.addr[2] = stored_uip_ethaddr_oct[3];
4784  c507 55401a000c    	mov	_uip_ethaddr+2,_stored_uip_ethaddr_oct+3
4785                     ; 1427     uip_ethaddr.addr[3] = stored_uip_ethaddr_oct[2];
4787  c50c 554019000d    	mov	_uip_ethaddr+3,_stored_uip_ethaddr_oct+2
4788                     ; 1428     uip_ethaddr.addr[4] = stored_uip_ethaddr_oct[1];
4790  c511 554018000e    	mov	_uip_ethaddr+4,_stored_uip_ethaddr_oct+1
4791                     ; 1429     uip_ethaddr.addr[5] = stored_uip_ethaddr_oct[0]; // LSB
4793  c516 554017000f    	mov	_uip_ethaddr+5,_stored_uip_ethaddr_oct
4794                     ; 1433     if (stored_config_settings[0] != '0' && stored_config_settings[0] != '1') {
4796  c51b c6404c        	ld	a,_stored_config_settings
4797  c51e a130          	cp	a,#48
4798  c520 270c          	jreq	L3252
4800  c522 a131          	cp	a,#49
4801  c524 2708          	jreq	L3252
4802                     ; 1434       stored_config_settings[0] = '0';
4804  c526 a630          	ld	a,#48
4805  c528 ae404c        	ldw	x,#_stored_config_settings
4806  c52b cdf6d8        	call	c_eewrc
4808  c52e               L3252:
4809                     ; 1436     if (stored_config_settings[1] != '0' && stored_config_settings[1] != '1') {
4811  c52e c6404d        	ld	a,_stored_config_settings+1
4812  c531 a130          	cp	a,#48
4813  c533 270c          	jreq	L5252
4815  c535 a131          	cp	a,#49
4816  c537 2708          	jreq	L5252
4817                     ; 1437       stored_config_settings[1] = '0';
4819  c539 a630          	ld	a,#48
4820  c53b ae404d        	ldw	x,#_stored_config_settings+1
4821  c53e cdf6d8        	call	c_eewrc
4823  c541               L5252:
4824                     ; 1439     if (stored_config_settings[2] != '0' && stored_config_settings[2] != '1' && stored_config_settings[2] != '2') {
4826  c541 c6404e        	ld	a,_stored_config_settings+2
4827  c544 a130          	cp	a,#48
4828  c546 2710          	jreq	L7252
4830  c548 a131          	cp	a,#49
4831  c54a 270c          	jreq	L7252
4833  c54c a132          	cp	a,#50
4834  c54e 2708          	jreq	L7252
4835                     ; 1440       stored_config_settings[2] = '2';
4837  c550 a632          	ld	a,#50
4838  c552 ae404e        	ldw	x,#_stored_config_settings+2
4839  c555 cdf6d8        	call	c_eewrc
4841  c558               L7252:
4842                     ; 1442     if (stored_config_settings[3] != '0' && stored_config_settings[3] != '1') {
4844  c558 c6404f        	ld	a,_stored_config_settings+3
4845  c55b a130          	cp	a,#48
4846  c55d 270c          	jreq	L1352
4848  c55f a131          	cp	a,#49
4849  c561 2708          	jreq	L1352
4850                     ; 1443       stored_config_settings[3] = '0';
4852  c563 a630          	ld	a,#48
4853  c565 ae404f        	ldw	x,#_stored_config_settings+3
4854  c568 cdf6d8        	call	c_eewrc
4856  c56b               L1352:
4857                     ; 1445     if (stored_config_settings[4] != '0') {
4859  c56b c64050        	ld	a,_stored_config_settings+4
4860  c56e a130          	cp	a,#48
4861  c570 2708          	jreq	L3352
4862                     ; 1446       stored_config_settings[4] = '0';
4864  c572 a630          	ld	a,#48
4865  c574 ae4050        	ldw	x,#_stored_config_settings+4
4866  c577 cdf6d8        	call	c_eewrc
4868  c57a               L3352:
4869                     ; 1448     if (stored_config_settings[5] != '0') {
4871  c57a c64051        	ld	a,_stored_config_settings+5
4872  c57d a130          	cp	a,#48
4873  c57f 2708          	jreq	L5352
4874                     ; 1449       stored_config_settings[5] = '0';
4876  c581 a630          	ld	a,#48
4877  c583 ae4051        	ldw	x,#_stored_config_settings+5
4878  c586 cdf6d8        	call	c_eewrc
4880  c589               L5352:
4881                     ; 1453     if (stored_config_settings[0] == '0') invert_output = 0x00;
4883  c589 c6404c        	ld	a,_stored_config_settings
4884  c58c a130          	cp	a,#48
4885  c58e 2606          	jrne	L7352
4888  c590 725f0166      	clr	_invert_output
4890  c594 2004          	jra	L1452
4891  c596               L7352:
4892                     ; 1454     else invert_output = 0xff;
4894  c596 35ff0166      	mov	_invert_output,#255
4895  c59a               L1452:
4896                     ; 1457     if (stored_config_settings[1] == '0') invert_input = 0x00;
4898  c59a c6404d        	ld	a,_stored_config_settings+1
4899  c59d a130          	cp	a,#48
4900  c59f 2606          	jrne	L3452
4903  c5a1 725f0165      	clr	_invert_input
4905  c5a5 2004          	jra	L5452
4906  c5a7               L3452:
4907                     ; 1458     else invert_input = 0xff;
4909  c5a7 35ff0165      	mov	_invert_input,#255
4910  c5ab               L5452:
4911                     ; 1463     if (stored_config_settings[2] == '0') {
4913  c5ab c6404e        	ld	a,_stored_config_settings+2
4914  c5ae a130          	cp	a,#48
4915  c5b0 260a          	jrne	L7452
4916                     ; 1465       IO_16to9 = 0x00;
4918  c5b2 725f016e      	clr	_IO_16to9
4919                     ; 1466       IO_8to1 = 0x00;
4921  c5b6 725f016d      	clr	_IO_8to1
4923  c5ba 2036          	jra	L1552
4924  c5bc               L7452:
4925                     ; 1468     else if (stored_config_settings[2] == '1') {
4927  c5bc a131          	cp	a,#49
4928  c5be 260a          	jrne	L3552
4929                     ; 1470       IO_16to9 = 0xff;
4931  c5c0 35ff016e      	mov	_IO_16to9,#255
4932                     ; 1471       IO_8to1 = 0xff;
4934  c5c4 35ff016d      	mov	_IO_8to1,#255
4936  c5c8 2028          	jra	L1552
4937  c5ca               L3552:
4938                     ; 1475       IO_16to9 = IO_16to9_new1 = IO_16to9_new2 = IO_16to9_sent = stored_IO_16to9;
4940  c5ca 55404b0168    	mov	_IO_16to9_sent,_stored_IO_16to9
4941  c5cf 550168016a    	mov	_IO_16to9_new2,_IO_16to9_sent
4942  c5d4 55016a016c    	mov	_IO_16to9_new1,_IO_16to9_new2
4943  c5d9 55016c016e    	mov	_IO_16to9,_IO_16to9_new1
4944                     ; 1476       IO_8to1  = IO_8to1_new1  = IO_8to1_new2  = IO_8to1_sent  = stored_IO_8to1;
4946  c5de 5540140167    	mov	_IO_8to1_sent,_stored_IO_8to1
4947  c5e3 5501670169    	mov	_IO_8to1_new2,_IO_8to1_sent
4948  c5e8 550169016b    	mov	_IO_8to1_new1,_IO_8to1_new2
4949  c5ed 55016b016d    	mov	_IO_8to1,_IO_8to1_new1
4950  c5f2               L1552:
4951                     ; 1480     write_output_registers();
4953  c5f2 cdce6e        	call	_write_output_registers
4956  c5f5 ccc857        	jra	L7552
4957  c5f8               L1652:
4958                     ; 1489     uip_ipaddr(IpAddr, 192,168,1,4);
4960  c5f8 aec0a8        	ldw	x,#49320
4961  c5fb cf00ff        	ldw	_IpAddr,x
4964  c5fe ae0104        	ldw	x,#260
4965  c601 cf0101        	ldw	_IpAddr+2,x
4966                     ; 1490     uip_sethostaddr(IpAddr);
4968  c604 ce00ff        	ldw	x,_IpAddr
4969  c607 cf02c0        	ldw	_uip_hostaddr,x
4972  c60a ce0101        	ldw	x,_IpAddr+2
4973  c60d cf02c2        	ldw	_uip_hostaddr+2,x
4974                     ; 1492     stored_hostaddr[3] = 192;	// MSB
4976  c610 a6c0          	ld	a,#192
4977  c612 ae402a        	ldw	x,#_stored_hostaddr+3
4978  c615 cdf6d8        	call	c_eewrc
4980                     ; 1493     stored_hostaddr[2] = 168;	//
4982  c618 a6a8          	ld	a,#168
4983  c61a ae4029        	ldw	x,#_stored_hostaddr+2
4984  c61d cdf6d8        	call	c_eewrc
4986                     ; 1494     stored_hostaddr[1] = 1;	//
4988  c620 a601          	ld	a,#1
4989  c622 ae4028        	ldw	x,#_stored_hostaddr+1
4990  c625 cdf6d8        	call	c_eewrc
4992                     ; 1495     stored_hostaddr[0] = 4;	// LSB
4994  c628 a604          	ld	a,#4
4995  c62a ae4027        	ldw	x,#_stored_hostaddr
4996  c62d cdf6d8        	call	c_eewrc
4998                     ; 1498     uip_ipaddr(IpAddr, 192,168,1,1);
5000  c630 aec0a8        	ldw	x,#49320
5001  c633 cf00ff        	ldw	_IpAddr,x
5004  c636 ae0101        	ldw	x,#257
5005  c639 cf0101        	ldw	_IpAddr+2,x
5006                     ; 1499     uip_setdraddr(IpAddr);
5008  c63c ce00ff        	ldw	x,_IpAddr
5009  c63f cf02b8        	ldw	_uip_draddr,x
5012  c642 ce0101        	ldw	x,_IpAddr+2
5013  c645 cf02ba        	ldw	_uip_draddr+2,x
5014                     ; 1501     stored_draddr[3] = 192;	// MSB
5016  c648 a6c0          	ld	a,#192
5017  c64a ae4026        	ldw	x,#_stored_draddr+3
5018  c64d cdf6d8        	call	c_eewrc
5020                     ; 1502     stored_draddr[2] = 168;	//
5022  c650 a6a8          	ld	a,#168
5023  c652 ae4025        	ldw	x,#_stored_draddr+2
5024  c655 cdf6d8        	call	c_eewrc
5026                     ; 1503     stored_draddr[1] = 1;		//
5028  c658 a601          	ld	a,#1
5029  c65a ae4024        	ldw	x,#_stored_draddr+1
5030  c65d cdf6d8        	call	c_eewrc
5032                     ; 1504     stored_draddr[0] = 1;		// LSB
5034  c660 a601          	ld	a,#1
5035  c662 ae4023        	ldw	x,#_stored_draddr
5036  c665 cdf6d8        	call	c_eewrc
5038                     ; 1507     uip_ipaddr(IpAddr, 255,255,255,0);
5040  c668 aeffff        	ldw	x,#65535
5041  c66b cf00ff        	ldw	_IpAddr,x
5044  c66e aeff00        	ldw	x,#65280
5045  c671 cf0101        	ldw	_IpAddr+2,x
5046                     ; 1508     uip_setnetmask(IpAddr);
5048  c674 ce00ff        	ldw	x,_IpAddr
5049  c677 cf02bc        	ldw	_uip_netmask,x
5052  c67a ce0101        	ldw	x,_IpAddr+2
5053  c67d cf02be        	ldw	_uip_netmask+2,x
5054                     ; 1510     stored_netmask[3] = 255;	// MSB
5056  c680 a6ff          	ld	a,#255
5057  c682 ae4022        	ldw	x,#_stored_netmask+3
5058  c685 cdf6d8        	call	c_eewrc
5060                     ; 1511     stored_netmask[2] = 255;	//
5062  c688 a6ff          	ld	a,#255
5063  c68a ae4021        	ldw	x,#_stored_netmask+2
5064  c68d cdf6d8        	call	c_eewrc
5066                     ; 1512     stored_netmask[1] = 255;	//
5068  c690 a6ff          	ld	a,#255
5069  c692 ae4020        	ldw	x,#_stored_netmask+1
5070  c695 cdf6d8        	call	c_eewrc
5072                     ; 1513     stored_netmask[0] = 0;	// LSB
5074  c698 4f            	clr	a
5075  c699 ae401f        	ldw	x,#_stored_netmask
5076  c69c cdf6d8        	call	c_eewrc
5078                     ; 1517     uip_ipaddr(IpAddr, 0,0,0,0);
5080  c69f 5f            	clrw	x
5081  c6a0 cf00ff        	ldw	_IpAddr,x
5084  c6a3 cf0101        	ldw	_IpAddr+2,x
5085                     ; 1518     uip_setmqttserveraddr(IpAddr);
5087  c6a6 cf02b4        	ldw	_uip_mqttserveraddr,x
5090  c6a9 cf02b6        	ldw	_uip_mqttserveraddr+2,x
5091                     ; 1521     stored_mqttserveraddr[3] = 0;	// MSB
5093  c6ac 4f            	clr	a
5094  c6ad ae4034        	ldw	x,#_stored_mqttserveraddr+3
5095  c6b0 cdf6d8        	call	c_eewrc
5097                     ; 1522     stored_mqttserveraddr[2] = 0;	//
5099  c6b3 4f            	clr	a
5100  c6b4 ae4033        	ldw	x,#_stored_mqttserveraddr+2
5101  c6b7 cdf6d8        	call	c_eewrc
5103                     ; 1523     stored_mqttserveraddr[1] = 0;	//
5105  c6ba 4f            	clr	a
5106  c6bb ae4032        	ldw	x,#_stored_mqttserveraddr+1
5107  c6be cdf6d8        	call	c_eewrc
5109                     ; 1524     stored_mqttserveraddr[0] = 0;	// LSB
5111  c6c1 4f            	clr	a
5112  c6c2 ae4031        	ldw	x,#_stored_mqttserveraddr
5113  c6c5 cdf6d8        	call	c_eewrc
5115                     ; 1527     stored_mqttport = 1883;		// Port
5117  c6c8 ae075b        	ldw	x,#1883
5118  c6cb 89            	pushw	x
5119  c6cc ae402f        	ldw	x,#_stored_mqttport
5120  c6cf cdf6c2        	call	c_eewrw
5122  c6d2 85            	popw	x
5123                     ; 1529     Port_Mqttd = 1883;
5125  c6d3 ae075b        	ldw	x,#1883
5126  c6d6 cf00f6        	ldw	_Port_Mqttd,x
5127                     ; 1532     for(i=0; i<11; i++) { stored_mqtt_username[i] = '\0'; }
5129  c6d9 4f            	clr	a
5130  c6da 6b01          	ld	(OFST+0,sp),a
5132  c6dc               L1262:
5135  c6dc 5f            	clrw	x
5136  c6dd 97            	ld	xl,a
5137  c6de 4f            	clr	a
5138  c6df 1c4035        	addw	x,#_stored_mqtt_username
5139  c6e2 cdf6d8        	call	c_eewrc
5143  c6e5 0c01          	inc	(OFST+0,sp)
5147  c6e7 7b01          	ld	a,(OFST+0,sp)
5148  c6e9 a10b          	cp	a,#11
5149  c6eb 25ef          	jrult	L1262
5150                     ; 1533     for(i=0; i<11; i++) { stored_mqtt_password[i] = '\0'; }
5152  c6ed 4f            	clr	a
5153  c6ee 6b01          	ld	(OFST+0,sp),a
5155  c6f0               L7262:
5158  c6f0 5f            	clrw	x
5159  c6f1 97            	ld	xl,a
5160  c6f2 4f            	clr	a
5161  c6f3 1c4040        	addw	x,#_stored_mqtt_password
5162  c6f6 cdf6d8        	call	c_eewrc
5166  c6f9 0c01          	inc	(OFST+0,sp)
5170  c6fb 7b01          	ld	a,(OFST+0,sp)
5171  c6fd a10b          	cp	a,#11
5172  c6ff 25ef          	jrult	L7262
5173                     ; 1538     stored_port = 8080;
5175  c701 ae1f90        	ldw	x,#8080
5176  c704 89            	pushw	x
5177  c705 ae401d        	ldw	x,#_stored_port
5178  c708 cdf6c2        	call	c_eewrw
5180  c70b 85            	popw	x
5181                     ; 1540     Port_Httpd = 8080;
5183  c70c ae1f90        	ldw	x,#8080
5184  c70f cf0103        	ldw	_Port_Httpd,x
5185                     ; 1556     stored_uip_ethaddr_oct[5] = 0xc2;	//MAC MSB
5187  c712 a6c2          	ld	a,#194
5188  c714 ae401c        	ldw	x,#_stored_uip_ethaddr_oct+5
5189  c717 cdf6d8        	call	c_eewrc
5191                     ; 1557     stored_uip_ethaddr_oct[4] = 0x4d;
5193  c71a a64d          	ld	a,#77
5194  c71c ae401b        	ldw	x,#_stored_uip_ethaddr_oct+4
5195  c71f cdf6d8        	call	c_eewrc
5197                     ; 1558     stored_uip_ethaddr_oct[3] = 0x69;
5199  c722 a669          	ld	a,#105
5200  c724 ae401a        	ldw	x,#_stored_uip_ethaddr_oct+3
5201  c727 cdf6d8        	call	c_eewrc
5203                     ; 1559     stored_uip_ethaddr_oct[2] = 0x6b;
5205  c72a a66b          	ld	a,#107
5206  c72c ae4019        	ldw	x,#_stored_uip_ethaddr_oct+2
5207  c72f cdf6d8        	call	c_eewrc
5209                     ; 1560     stored_uip_ethaddr_oct[1] = 0x65;
5211  c732 a665          	ld	a,#101
5212  c734 ae4018        	ldw	x,#_stored_uip_ethaddr_oct+1
5213  c737 cdf6d8        	call	c_eewrc
5215                     ; 1561     stored_uip_ethaddr_oct[0] = 0x00;	//MAC LSB
5217  c73a 4f            	clr	a
5218  c73b ae4017        	ldw	x,#_stored_uip_ethaddr_oct
5219  c73e cdf6d8        	call	c_eewrc
5221                     ; 1563     uip_ethaddr.addr[0] = stored_uip_ethaddr_oct[5]; // MSB
5223  c741 35c2000a      	mov	_uip_ethaddr,#194
5224                     ; 1564     uip_ethaddr.addr[1] = stored_uip_ethaddr_oct[4];
5226  c745 354d000b      	mov	_uip_ethaddr+1,#77
5227                     ; 1565     uip_ethaddr.addr[2] = stored_uip_ethaddr_oct[3];
5229  c749 3569000c      	mov	_uip_ethaddr+2,#105
5230                     ; 1566     uip_ethaddr.addr[3] = stored_uip_ethaddr_oct[2];
5232  c74d 356b000d      	mov	_uip_ethaddr+3,#107
5233                     ; 1567     uip_ethaddr.addr[4] = stored_uip_ethaddr_oct[1];
5235  c751 3565000e      	mov	_uip_ethaddr+4,#101
5236                     ; 1568     uip_ethaddr.addr[5] = stored_uip_ethaddr_oct[0]; // LSB
5238  c755 725f000f      	clr	_uip_ethaddr+5
5239                     ; 1571     stored_devicename[0] =  'N';
5241  c759 a64e          	ld	a,#78
5242  c75b ae4000        	ldw	x,#_stored_devicename
5243  c75e cdf6d8        	call	c_eewrc
5245                     ; 1572     stored_devicename[1] =  'e';
5247  c761 a665          	ld	a,#101
5248  c763 ae4001        	ldw	x,#_stored_devicename+1
5249  c766 cdf6d8        	call	c_eewrc
5251                     ; 1573     stored_devicename[2] =  'w';
5253  c769 a677          	ld	a,#119
5254  c76b ae4002        	ldw	x,#_stored_devicename+2
5255  c76e cdf6d8        	call	c_eewrc
5257                     ; 1574     stored_devicename[3] =  'D';
5259  c771 a644          	ld	a,#68
5260  c773 ae4003        	ldw	x,#_stored_devicename+3
5261  c776 cdf6d8        	call	c_eewrc
5263                     ; 1575     stored_devicename[4] =  'e';
5265  c779 a665          	ld	a,#101
5266  c77b ae4004        	ldw	x,#_stored_devicename+4
5267  c77e cdf6d8        	call	c_eewrc
5269                     ; 1576     stored_devicename[5] =  'v';
5271  c781 a676          	ld	a,#118
5272  c783 ae4005        	ldw	x,#_stored_devicename+5
5273  c786 cdf6d8        	call	c_eewrc
5275                     ; 1577     stored_devicename[6] =  'i';
5277  c789 a669          	ld	a,#105
5278  c78b ae4006        	ldw	x,#_stored_devicename+6
5279  c78e cdf6d8        	call	c_eewrc
5281                     ; 1578     stored_devicename[7] =  'c';
5283  c791 a663          	ld	a,#99
5284  c793 ae4007        	ldw	x,#_stored_devicename+7
5285  c796 cdf6d8        	call	c_eewrc
5287                     ; 1579     stored_devicename[8] =  'e';
5289  c799 a665          	ld	a,#101
5290  c79b ae4008        	ldw	x,#_stored_devicename+8
5291  c79e cdf6d8        	call	c_eewrc
5293                     ; 1580     stored_devicename[9] =  '0';
5295  c7a1 a630          	ld	a,#48
5296  c7a3 ae4009        	ldw	x,#_stored_devicename+9
5297  c7a6 cdf6d8        	call	c_eewrc
5299                     ; 1581     stored_devicename[10] = '0';
5301  c7a9 a630          	ld	a,#48
5302  c7ab ae400a        	ldw	x,#_stored_devicename+10
5303  c7ae cdf6d8        	call	c_eewrc
5305                     ; 1582     stored_devicename[11] = '0';
5307  c7b1 a630          	ld	a,#48
5308  c7b3 ae400b        	ldw	x,#_stored_devicename+11
5309  c7b6 cdf6d8        	call	c_eewrc
5311                     ; 1583     for (i=12; i<20; i++) stored_devicename[i] = '\0';
5313  c7b9 a60c          	ld	a,#12
5314  c7bb 6b01          	ld	(OFST+0,sp),a
5316  c7bd               L5362:
5319  c7bd 5f            	clrw	x
5320  c7be 97            	ld	xl,a
5321  c7bf 4f            	clr	a
5322  c7c0 1c4000        	addw	x,#_stored_devicename
5323  c7c3 cdf6d8        	call	c_eewrc
5327  c7c6 0c01          	inc	(OFST+0,sp)
5331  c7c8 7b01          	ld	a,(OFST+0,sp)
5332  c7ca a114          	cp	a,#20
5333  c7cc 25ef          	jrult	L5362
5334                     ; 1588     stored_config_settings[0] = '0'; // Set to Invert Output OFF
5336  c7ce a630          	ld	a,#48
5337  c7d0 ae404c        	ldw	x,#_stored_config_settings
5338  c7d3 cdf6d8        	call	c_eewrc
5340                     ; 1589     stored_config_settings[1] = '0'; // Set to Invert Input Off
5342  c7d6 a630          	ld	a,#48
5343  c7d8 ae404d        	ldw	x,#_stored_config_settings+1
5344  c7db cdf6d8        	call	c_eewrc
5346                     ; 1590     stored_config_settings[2] = '2'; // Set to Retain pin states
5348  c7de a632          	ld	a,#50
5349  c7e0 ae404e        	ldw	x,#_stored_config_settings+2
5350  c7e3 cdf6d8        	call	c_eewrc
5352                     ; 1591     stored_config_settings[3] = '0'; // Set to Half Duplex
5354  c7e6 a630          	ld	a,#48
5355  c7e8 ae404f        	ldw	x,#_stored_config_settings+3
5356  c7eb cdf6d8        	call	c_eewrc
5358                     ; 1592     stored_config_settings[4] = '0'; // undefined
5360  c7ee a630          	ld	a,#48
5361  c7f0 ae4050        	ldw	x,#_stored_config_settings+4
5362  c7f3 cdf6d8        	call	c_eewrc
5364                     ; 1593     stored_config_settings[5] = '0'; // undefined
5366  c7f6 a630          	ld	a,#48
5367  c7f8 ae4051        	ldw	x,#_stored_config_settings+5
5368  c7fb cdf6d8        	call	c_eewrc
5370                     ; 1594     invert_output = 0x00;			// Turn off output invert bit
5372  c7fe 725f0166      	clr	_invert_output
5373                     ; 1595     invert_input = 0x00;			// Turn off output invert bit
5375  c802 725f0165      	clr	_invert_input
5376                     ; 1596     IO_16to9 = IO_16to9_new1 = IO_16to9_new2 = IO_16to9_sent = stored_IO_16to9 = 0x00;
5378  c806 4f            	clr	a
5379  c807 ae404b        	ldw	x,#_stored_IO_16to9
5380  c80a cdf6d8        	call	c_eewrc
5382  c80d 725f0168      	clr	_IO_16to9_sent
5383  c811 725f016a      	clr	_IO_16to9_new2
5384  c815 725f016c      	clr	_IO_16to9_new1
5385  c819 725f016e      	clr	_IO_16to9
5386                     ; 1597     IO_8to1  = IO_8to1_new1  = IO_8to1_new2  = IO_8to1_sent  = stored_IO_8to1  = 0x00;
5388  c81d 4f            	clr	a
5389  c81e ae4014        	ldw	x,#_stored_IO_8to1
5390  c821 cdf6d8        	call	c_eewrc
5392  c824 725f0167      	clr	_IO_8to1_sent
5393  c828 725f0169      	clr	_IO_8to1_new2
5394  c82c 725f016b      	clr	_IO_8to1_new1
5395  c830 725f016d      	clr	_IO_8to1
5396                     ; 1598     write_output_registers();          // Set Relay Control outputs
5398  c834 cdce6e        	call	_write_output_registers
5400                     ; 1601     magic4 = 0x55;		// MSB
5402  c837 a655          	ld	a,#85
5403  c839 ae402e        	ldw	x,#_magic4
5404  c83c cdf6d8        	call	c_eewrc
5406                     ; 1602     magic3 = 0xee;		//
5408  c83f a6ee          	ld	a,#238
5409  c841 ae402d        	ldw	x,#_magic3
5410  c844 cdf6d8        	call	c_eewrc
5412                     ; 1603     magic2 = 0x0f;		//
5414  c847 a60f          	ld	a,#15
5415  c849 ae402c        	ldw	x,#_magic2
5416  c84c cdf6d8        	call	c_eewrc
5418                     ; 1604     magic1 = 0xf0;		// LSB
5420  c84f a6f0          	ld	a,#240
5421  c851 ae402b        	ldw	x,#_magic1
5422  c854 cdf6d8        	call	c_eewrc
5424  c857               L7552:
5425                     ; 1609   for (i=0; i<4; i++) {
5427  c857 4f            	clr	a
5428  c858 6b01          	ld	(OFST+0,sp),a
5430  c85a               L3462:
5431                     ; 1610     Pending_hostaddr[i] = stored_hostaddr[i];
5433  c85a 5f            	clrw	x
5434  c85b 97            	ld	xl,a
5435  c85c d64027        	ld	a,(_stored_hostaddr,x)
5436  c85f d70143        	ld	(_Pending_hostaddr,x),a
5437                     ; 1611     Pending_draddr[i] = stored_draddr[i];
5439  c862 5f            	clrw	x
5440  c863 7b01          	ld	a,(OFST+0,sp)
5441  c865 97            	ld	xl,a
5442  c866 d64023        	ld	a,(_stored_draddr,x)
5443  c869 d7013f        	ld	(_Pending_draddr,x),a
5444                     ; 1612     Pending_netmask[i] = stored_netmask[i];
5446  c86c 5f            	clrw	x
5447  c86d 7b01          	ld	a,(OFST+0,sp)
5448  c86f 97            	ld	xl,a
5449  c870 d6401f        	ld	a,(_stored_netmask,x)
5450  c873 d7013b        	ld	(_Pending_netmask,x),a
5451                     ; 1609   for (i=0; i<4; i++) {
5453  c876 0c01          	inc	(OFST+0,sp)
5457  c878 7b01          	ld	a,(OFST+0,sp)
5458  c87a a104          	cp	a,#4
5459  c87c 25dc          	jrult	L3462
5460                     ; 1615   Pending_port = stored_port;
5462  c87e ce401d        	ldw	x,_stored_port
5463  c881 cf0139        	ldw	_Pending_port,x
5464                     ; 1617   for (i=0; i<20; i++) {
5466  c884 4f            	clr	a
5467  c885 6b01          	ld	(OFST+0,sp),a
5469  c887               L1562:
5470                     ; 1618     Pending_devicename[i] = stored_devicename[i];
5472  c887 5f            	clrw	x
5473  c888 97            	ld	xl,a
5474  c889 d64000        	ld	a,(_stored_devicename,x)
5475  c88c d70125        	ld	(_Pending_devicename,x),a
5476                     ; 1617   for (i=0; i<20; i++) {
5478  c88f 0c01          	inc	(OFST+0,sp)
5482  c891 7b01          	ld	a,(OFST+0,sp)
5483  c893 a114          	cp	a,#20
5484  c895 25f0          	jrult	L1562
5485                     ; 1621   for (i=0; i<6; i++) {
5487  c897 4f            	clr	a
5488  c898 6b01          	ld	(OFST+0,sp),a
5490  c89a               L7562:
5491                     ; 1622     Pending_config_settings[i] = stored_config_settings[i];
5493  c89a 5f            	clrw	x
5494  c89b 97            	ld	xl,a
5495  c89c d6404c        	ld	a,(_stored_config_settings,x)
5496  c89f d7011f        	ld	(_Pending_config_settings,x),a
5497                     ; 1623     Pending_uip_ethaddr_oct[i] = stored_uip_ethaddr_oct[i];
5499  c8a2 5f            	clrw	x
5500  c8a3 7b01          	ld	a,(OFST+0,sp)
5501  c8a5 97            	ld	xl,a
5502  c8a6 d64017        	ld	a,(_stored_uip_ethaddr_oct,x)
5503  c8a9 d70119        	ld	(_Pending_uip_ethaddr_oct,x),a
5504                     ; 1621   for (i=0; i<6; i++) {
5506  c8ac 0c01          	inc	(OFST+0,sp)
5510  c8ae 7b01          	ld	a,(OFST+0,sp)
5511  c8b0 a106          	cp	a,#6
5512  c8b2 25e6          	jrult	L7562
5513                     ; 1627   for (i=0; i<4; i++) {
5515  c8b4 4f            	clr	a
5516  c8b5 6b01          	ld	(OFST+0,sp),a
5518  c8b7               L5662:
5519                     ; 1628     Pending_mqttserveraddr[i] = stored_mqttserveraddr[i];
5521  c8b7 5f            	clrw	x
5522  c8b8 97            	ld	xl,a
5523  c8b9 d64031        	ld	a,(_stored_mqttserveraddr,x)
5524  c8bc d7015f        	ld	(_Pending_mqttserveraddr,x),a
5525                     ; 1627   for (i=0; i<4; i++) {
5527  c8bf 0c01          	inc	(OFST+0,sp)
5531  c8c1 7b01          	ld	a,(OFST+0,sp)
5532  c8c3 a104          	cp	a,#4
5533  c8c5 25f0          	jrult	L5662
5534                     ; 1630   Pending_mqttport = stored_mqttport;
5536  c8c7 ce402f        	ldw	x,_stored_mqttport
5537  c8ca cf015d        	ldw	_Pending_mqttport,x
5538                     ; 1631   for (i=0; i<11; i++) {
5540  c8cd 4f            	clr	a
5541  c8ce 6b01          	ld	(OFST+0,sp),a
5543  c8d0               L3762:
5544                     ; 1632     Pending_mqtt_username[i] = stored_mqtt_username[i];
5546  c8d0 5f            	clrw	x
5547  c8d1 97            	ld	xl,a
5548  c8d2 d64035        	ld	a,(_stored_mqtt_username,x)
5549  c8d5 d70152        	ld	(_Pending_mqtt_username,x),a
5550                     ; 1633     Pending_mqtt_password[i] = stored_mqtt_password[i];
5552  c8d8 5f            	clrw	x
5553  c8d9 7b01          	ld	a,(OFST+0,sp)
5554  c8db 97            	ld	xl,a
5555  c8dc d64040        	ld	a,(_stored_mqtt_password,x)
5556  c8df d70147        	ld	(_Pending_mqtt_password,x),a
5557                     ; 1631   for (i=0; i<11; i++) {
5559  c8e2 0c01          	inc	(OFST+0,sp)
5563  c8e4 7b01          	ld	a,(OFST+0,sp)
5564  c8e6 a10b          	cp	a,#11
5565  c8e8 25e6          	jrult	L3762
5566                     ; 1636   strcat(topic_base, stored_devicename);
5568  c8ea ae4000        	ldw	x,#_stored_devicename
5569  c8ed 89            	pushw	x
5570  c8ee ae0074        	ldw	x,#_topic_base
5571  c8f1 cdf694        	call	_strcat
5573  c8f4 85            	popw	x
5574                     ; 1639   topic_base_len = (uint8_t)strlen(topic_base);
5576  c8f5 ae0074        	ldw	x,#_topic_base
5577  c8f8 cdf6a8        	call	_strlen
5579  c8fb 9f            	ld	a,xl
5580  c8fc c70073        	ld	_topic_base_len,a
5581                     ; 1643   update_mac_string();
5583  c8ff cdc904        	call	_update_mac_string
5585                     ; 1645 }
5588  c902 84            	pop	a
5589  c903 81            	ret	
5632                     ; 1648 void update_mac_string(void) {
5633                     .text:	section	.text,new
5634  c904               _update_mac_string:
5636  c904 89            	pushw	x
5637       00000002      OFST:	set	2
5640                     ; 1654   i = 5;
5642  c905 a605          	ld	a,#5
5643  c907 6b01          	ld	(OFST-1,sp),a
5645                     ; 1655   j = 0;
5647  c909 0f02          	clr	(OFST+0,sp)
5649  c90b               L7172:
5650                     ; 1657     emb_itoa(stored_uip_ethaddr_oct[i], OctetArray, 16, 2);
5652  c90b 4b02          	push	#2
5653  c90d 4b10          	push	#16
5654  c90f ae005c        	ldw	x,#_OctetArray
5655  c912 89            	pushw	x
5656  c913 7b05          	ld	a,(OFST+3,sp)
5657  c915 5f            	clrw	x
5658  c916 97            	ld	xl,a
5659  c917 d64017        	ld	a,(_stored_uip_ethaddr_oct,x)
5660  c91a b703          	ld	c_lreg+3,a
5661  c91c 3f02          	clr	c_lreg+2
5662  c91e 3f01          	clr	c_lreg+1
5663  c920 3f00          	clr	c_lreg
5664  c922 be02          	ldw	x,c_lreg+2
5665  c924 89            	pushw	x
5666  c925 be00          	ldw	x,c_lreg
5667  c927 89            	pushw	x
5668  c928 cda4d6        	call	_emb_itoa
5670  c92b 5b08          	addw	sp,#8
5671                     ; 1658     mac_string[j++] = OctetArray[0];
5673  c92d 7b02          	ld	a,(OFST+0,sp)
5674  c92f 0c02          	inc	(OFST+0,sp)
5676  c931 5f            	clrw	x
5677  c932 97            	ld	xl,a
5678  c933 c6005c        	ld	a,_OctetArray
5679  c936 d7010c        	ld	(_mac_string,x),a
5680                     ; 1659     mac_string[j++] = OctetArray[1];
5682  c939 7b02          	ld	a,(OFST+0,sp)
5683  c93b 0c02          	inc	(OFST+0,sp)
5685  c93d 5f            	clrw	x
5686  c93e 97            	ld	xl,a
5687  c93f c6005d        	ld	a,_OctetArray+1
5688  c942 d7010c        	ld	(_mac_string,x),a
5689                     ; 1660     i--;
5691  c945 0a01          	dec	(OFST-1,sp)
5693                     ; 1656   while (j<12) {
5695  c947 7b02          	ld	a,(OFST+0,sp)
5696  c949 a10c          	cp	a,#12
5697  c94b 25be          	jrult	L7172
5698                     ; 1662   mac_string[12] = '\0';
5700  c94d 725f0118      	clr	_mac_string+12
5701                     ; 1663 }
5704  c951 85            	popw	x
5705  c952 81            	ret	
5783                     ; 1666 void check_runtime_changes(void)
5783                     ; 1667 {
5784                     .text:	section	.text,new
5785  c953               _check_runtime_changes:
5787  c953 88            	push	a
5788       00000001      OFST:	set	1
5791                     ; 1680   read_input_registers();
5793  c954 cdcdd6        	call	_read_input_registers
5795                     ; 1682   if (parse_complete == 1 || mqtt_parse_complete == 1) {
5797  c957 c60106        	ld	a,_parse_complete
5798  c95a 4a            	dec	a
5799  c95b 2706          	jreq	L3472
5801  c95d c60105        	ld	a,_mqtt_parse_complete
5802  c960 4a            	dec	a
5803  c961 2624          	jrne	L1472
5804  c963               L3472:
5805                     ; 1706     if (stored_IO_8to1 != IO_8to1) {
5807  c963 c64014        	ld	a,_stored_IO_8to1
5808  c966 c1016d        	cp	a,_IO_8to1
5809  c969 2710          	jreq	L5472
5810                     ; 1710       if (stored_config_settings[2] == '2') {
5812  c96b c6404e        	ld	a,_stored_config_settings+2
5813  c96e a132          	cp	a,#50
5814  c970 2609          	jrne	L5472
5815                     ; 1711         stored_IO_8to1 = IO_8to1;
5817  c972 c6016d        	ld	a,_IO_8to1
5818  c975 ae4014        	ldw	x,#_stored_IO_8to1
5819  c978 cdf6d8        	call	c_eewrc
5821  c97b               L5472:
5822                     ; 1715     write_output_registers();
5824  c97b cdce6e        	call	_write_output_registers
5826                     ; 1721     if (mqtt_parse_complete == 1) {
5828  c97e c60105        	ld	a,_mqtt_parse_complete
5829  c981 4a            	dec	a
5830  c982 2603          	jrne	L1472
5831                     ; 1723       mqtt_parse_complete = 0;
5833  c984 c70105        	ld	_mqtt_parse_complete,a
5834  c987               L1472:
5835                     ; 1728   if (parse_complete == 1) {
5837  c987 c60106        	ld	a,_parse_complete
5838  c98a 4a            	dec	a
5839  c98b 2703cccc18    	jrne	L3572
5840                     ; 1769     if ((Pending_config_settings[0] != stored_config_settings[0])
5840                     ; 1770      || (stored_IO_8to1 != IO_8to1)) {
5842  c990 c6404c        	ld	a,_stored_config_settings
5843  c993 c1011f        	cp	a,_Pending_config_settings
5844  c996 2608          	jrne	L7572
5846  c998 c64014        	ld	a,_stored_IO_8to1
5847  c99b c1016d        	cp	a,_IO_8to1
5848  c99e 272d          	jreq	L5572
5849  c9a0               L7572:
5850                     ; 1773       stored_config_settings[0] = Pending_config_settings[0];
5852  c9a0 c6011f        	ld	a,_Pending_config_settings
5853  c9a3 ae404c        	ldw	x,#_stored_config_settings
5854  c9a6 cdf6d8        	call	c_eewrc
5856                     ; 1776       if (stored_config_settings[0] == '0') invert_output = 0x00;
5858  c9a9 c6404c        	ld	a,_stored_config_settings
5859  c9ac a130          	cp	a,#48
5860  c9ae 2606          	jrne	L1672
5863  c9b0 725f0166      	clr	_invert_output
5865  c9b4 2004          	jra	L3672
5866  c9b6               L1672:
5867                     ; 1777       else invert_output = 0xff;
5869  c9b6 35ff0166      	mov	_invert_output,#255
5870  c9ba               L3672:
5871                     ; 1781       if (stored_config_settings[2] == '2') {
5873  c9ba c6404e        	ld	a,_stored_config_settings+2
5874  c9bd a132          	cp	a,#50
5875  c9bf 2609          	jrne	L5672
5876                     ; 1782         stored_IO_8to1 = IO_8to1;
5878  c9c1 c6016d        	ld	a,_IO_8to1
5879  c9c4 ae4014        	ldw	x,#_stored_IO_8to1
5880  c9c7 cdf6d8        	call	c_eewrc
5882  c9ca               L5672:
5883                     ; 1786       write_output_registers();
5885  c9ca cdce6e        	call	_write_output_registers
5887  c9cd               L5572:
5888                     ; 1790     if (Pending_config_settings[1] != stored_config_settings[1]) {
5890  c9cd c6404d        	ld	a,_stored_config_settings+1
5891  c9d0 c10120        	cp	a,_Pending_config_settings+1
5892  c9d3 271e          	jreq	L7672
5893                     ; 1792       stored_config_settings[1] = Pending_config_settings[1];
5895  c9d5 c60120        	ld	a,_Pending_config_settings+1
5896  c9d8 ae404d        	ldw	x,#_stored_config_settings+1
5897  c9db cdf6d8        	call	c_eewrc
5899                     ; 1795       if (stored_config_settings[1] == '0') invert_input = 0x00;
5901  c9de c6404d        	ld	a,_stored_config_settings+1
5902  c9e1 a130          	cp	a,#48
5903  c9e3 2606          	jrne	L1772
5906  c9e5 725f0165      	clr	_invert_input
5908  c9e9 2004          	jra	L3772
5909  c9eb               L1772:
5910                     ; 1796       else invert_input = 0xff;
5912  c9eb 35ff0165      	mov	_invert_input,#255
5913  c9ef               L3772:
5914                     ; 1800       restart_request = 1;
5916  c9ef 35010109      	mov	_restart_request,#1
5917  c9f3               L7672:
5918                     ; 1834     if (Pending_config_settings[2] != stored_config_settings[2]) {
5920  c9f3 c6404e        	ld	a,_stored_config_settings+2
5921  c9f6 c10121        	cp	a,_Pending_config_settings+2
5922  c9f9 2709          	jreq	L5772
5923                     ; 1836       stored_config_settings[2] = Pending_config_settings[2];
5925  c9fb c60121        	ld	a,_Pending_config_settings+2
5926  c9fe ae404e        	ldw	x,#_stored_config_settings+2
5927  ca01 cdf6d8        	call	c_eewrc
5929  ca04               L5772:
5930                     ; 1840     if (Pending_config_settings[3] != stored_config_settings[3]) {
5932  ca04 c6404f        	ld	a,_stored_config_settings+3
5933  ca07 c10122        	cp	a,_Pending_config_settings+3
5934  ca0a 270d          	jreq	L7772
5935                     ; 1843       stored_config_settings[3] = Pending_config_settings[3];
5937  ca0c c60122        	ld	a,_Pending_config_settings+3
5938  ca0f ae404f        	ldw	x,#_stored_config_settings+3
5939  ca12 cdf6d8        	call	c_eewrc
5941                     ; 1845       user_reboot_request = 1;
5943  ca15 3501010a      	mov	_user_reboot_request,#1
5944  ca19               L7772:
5945                     ; 1848     stored_config_settings[4] = Pending_config_settings[4];
5947  ca19 c60123        	ld	a,_Pending_config_settings+4
5948  ca1c ae4050        	ldw	x,#_stored_config_settings+4
5949  ca1f cdf6d8        	call	c_eewrc
5951                     ; 1849     stored_config_settings[5] = Pending_config_settings[5];
5953  ca22 c60124        	ld	a,_Pending_config_settings+5
5954  ca25 ae4051        	ldw	x,#_stored_config_settings+5
5955  ca28 cdf6d8        	call	c_eewrc
5957                     ; 1852     if (stored_hostaddr[3] != Pending_hostaddr[3] ||
5957                     ; 1853         stored_hostaddr[2] != Pending_hostaddr[2] ||
5957                     ; 1854         stored_hostaddr[1] != Pending_hostaddr[1] ||
5957                     ; 1855         stored_hostaddr[0] != Pending_hostaddr[0]) {
5959  ca2b c6402a        	ld	a,_stored_hostaddr+3
5960  ca2e c10146        	cp	a,_Pending_hostaddr+3
5961  ca31 2618          	jrne	L3003
5963  ca33 c64029        	ld	a,_stored_hostaddr+2
5964  ca36 c10145        	cp	a,_Pending_hostaddr+2
5965  ca39 2610          	jrne	L3003
5967  ca3b c64028        	ld	a,_stored_hostaddr+1
5968  ca3e c10144        	cp	a,_Pending_hostaddr+1
5969  ca41 2608          	jrne	L3003
5971  ca43 c64027        	ld	a,_stored_hostaddr
5972  ca46 c10143        	cp	a,_Pending_hostaddr
5973  ca49 2713          	jreq	L1003
5974  ca4b               L3003:
5975                     ; 1857       for (i=0; i<4; i++) stored_hostaddr[i] = Pending_hostaddr[i];
5977  ca4b 4f            	clr	a
5978  ca4c 6b01          	ld	(OFST+0,sp),a
5980  ca4e               L1103:
5983  ca4e 5f            	clrw	x
5984  ca4f 97            	ld	xl,a
5985  ca50 d60143        	ld	a,(_Pending_hostaddr,x)
5986  ca53 d74027        	ld	(_stored_hostaddr,x),a
5989  ca56 0c01          	inc	(OFST+0,sp)
5993  ca58 7b01          	ld	a,(OFST+0,sp)
5994  ca5a a104          	cp	a,#4
5995  ca5c 25f0          	jrult	L1103
5996  ca5e               L1003:
5997                     ; 1861     if (stored_draddr[3] != Pending_draddr[3] ||
5997                     ; 1862         stored_draddr[2] != Pending_draddr[2] ||
5997                     ; 1863         stored_draddr[1] != Pending_draddr[1] ||
5997                     ; 1864         stored_draddr[0] != Pending_draddr[0]) {
5999  ca5e c64026        	ld	a,_stored_draddr+3
6000  ca61 c10142        	cp	a,_Pending_draddr+3
6001  ca64 2618          	jrne	L1203
6003  ca66 c64025        	ld	a,_stored_draddr+2
6004  ca69 c10141        	cp	a,_Pending_draddr+2
6005  ca6c 2610          	jrne	L1203
6007  ca6e c64024        	ld	a,_stored_draddr+1
6008  ca71 c10140        	cp	a,_Pending_draddr+1
6009  ca74 2608          	jrne	L1203
6011  ca76 c64023        	ld	a,_stored_draddr
6012  ca79 c1013f        	cp	a,_Pending_draddr
6013  ca7c 2717          	jreq	L7103
6014  ca7e               L1203:
6015                     ; 1866       for (i=0; i<4; i++) stored_draddr[i] = Pending_draddr[i];
6017  ca7e 4f            	clr	a
6018  ca7f 6b01          	ld	(OFST+0,sp),a
6020  ca81               L7203:
6023  ca81 5f            	clrw	x
6024  ca82 97            	ld	xl,a
6025  ca83 d6013f        	ld	a,(_Pending_draddr,x)
6026  ca86 d74023        	ld	(_stored_draddr,x),a
6029  ca89 0c01          	inc	(OFST+0,sp)
6033  ca8b 7b01          	ld	a,(OFST+0,sp)
6034  ca8d a104          	cp	a,#4
6035  ca8f 25f0          	jrult	L7203
6036                     ; 1867       restart_request = 1;
6038  ca91 35010109      	mov	_restart_request,#1
6039  ca95               L7103:
6040                     ; 1871     if (stored_netmask[3] != Pending_netmask[3] ||
6040                     ; 1872         stored_netmask[2] != Pending_netmask[2] ||
6040                     ; 1873         stored_netmask[1] != Pending_netmask[1] ||
6040                     ; 1874         stored_netmask[0] != Pending_netmask[0]) {
6042  ca95 c64022        	ld	a,_stored_netmask+3
6043  ca98 c1013e        	cp	a,_Pending_netmask+3
6044  ca9b 2618          	jrne	L7303
6046  ca9d c64021        	ld	a,_stored_netmask+2
6047  caa0 c1013d        	cp	a,_Pending_netmask+2
6048  caa3 2610          	jrne	L7303
6050  caa5 c64020        	ld	a,_stored_netmask+1
6051  caa8 c1013c        	cp	a,_Pending_netmask+1
6052  caab 2608          	jrne	L7303
6054  caad c6401f        	ld	a,_stored_netmask
6055  cab0 c1013b        	cp	a,_Pending_netmask
6056  cab3 2717          	jreq	L5303
6057  cab5               L7303:
6058                     ; 1876       for (i=0; i<4; i++) stored_netmask[i] = Pending_netmask[i];
6060  cab5 4f            	clr	a
6061  cab6 6b01          	ld	(OFST+0,sp),a
6063  cab8               L5403:
6066  cab8 5f            	clrw	x
6067  cab9 97            	ld	xl,a
6068  caba d6013b        	ld	a,(_Pending_netmask,x)
6069  cabd d7401f        	ld	(_stored_netmask,x),a
6072  cac0 0c01          	inc	(OFST+0,sp)
6076  cac2 7b01          	ld	a,(OFST+0,sp)
6077  cac4 a104          	cp	a,#4
6078  cac6 25f0          	jrult	L5403
6079                     ; 1877       restart_request = 1;
6081  cac8 35010109      	mov	_restart_request,#1
6082  cacc               L5303:
6083                     ; 1881     if (stored_port != Pending_port) {
6085  cacc ce401d        	ldw	x,_stored_port
6086  cacf c30139        	cpw	x,_Pending_port
6087  cad2 270f          	jreq	L3503
6088                     ; 1883       stored_port = Pending_port;
6090  cad4 ce0139        	ldw	x,_Pending_port
6091  cad7 89            	pushw	x
6092  cad8 ae401d        	ldw	x,#_stored_port
6093  cadb cdf6c2        	call	c_eewrw
6095  cade 35010109      	mov	_restart_request,#1
6096  cae2 85            	popw	x
6097                     ; 1885       restart_request = 1;
6099  cae3               L3503:
6100                     ; 1889     for(i=0; i<20; i++) {
6102  cae3 4f            	clr	a
6103  cae4 6b01          	ld	(OFST+0,sp),a
6105  cae6               L5503:
6106                     ; 1890       if (stored_devicename[i] != Pending_devicename[i]) {
6108  cae6 5f            	clrw	x
6109  cae7 97            	ld	xl,a
6110  cae8 905f          	clrw	y
6111  caea 9097          	ld	yl,a
6112  caec 90d64000      	ld	a,(_stored_devicename,y)
6113  caf0 d10125        	cp	a,(_Pending_devicename,x)
6114  caf3 270e          	jreq	L3603
6115                     ; 1891         stored_devicename[i] = Pending_devicename[i];
6117  caf5 7b01          	ld	a,(OFST+0,sp)
6118  caf7 5f            	clrw	x
6119  caf8 97            	ld	xl,a
6120  caf9 d60125        	ld	a,(_Pending_devicename,x)
6121  cafc d74000        	ld	(_stored_devicename,x),a
6122                     ; 1897         restart_request = 1;
6124  caff 35010109      	mov	_restart_request,#1
6125  cb03               L3603:
6126                     ; 1889     for(i=0; i<20; i++) {
6128  cb03 0c01          	inc	(OFST+0,sp)
6132  cb05 7b01          	ld	a,(OFST+0,sp)
6133  cb07 a114          	cp	a,#20
6134  cb09 25db          	jrult	L5503
6135                     ; 1904     strcpy(topic_base, devicetype);
6137  cb0b ae0074        	ldw	x,#_topic_base
6138  cb0e 90ae9e68      	ldw	y,#L5261_devicetype
6139  cb12               L403:
6140  cb12 90f6          	ld	a,(y)
6141  cb14 905c          	incw	y
6142  cb16 f7            	ld	(x),a
6143  cb17 5c            	incw	x
6144  cb18 4d            	tnz	a
6145  cb19 26f7          	jrne	L403
6146                     ; 1905     strcat(topic_base, stored_devicename);
6148  cb1b ae4000        	ldw	x,#_stored_devicename
6149  cb1e 89            	pushw	x
6150  cb1f ae0074        	ldw	x,#_topic_base
6151  cb22 cdf694        	call	_strcat
6153  cb25 85            	popw	x
6154                     ; 1906     topic_base_len = (uint8_t)strlen(topic_base);
6156  cb26 ae0074        	ldw	x,#_topic_base
6157  cb29 cdf6a8        	call	_strlen
6159  cb2c 9f            	ld	a,xl
6160  cb2d c70073        	ld	_topic_base_len,a
6161                     ; 1909     if (stored_mqttserveraddr[3] != Pending_mqttserveraddr[3] ||
6161                     ; 1910         stored_mqttserveraddr[2] != Pending_mqttserveraddr[2] ||
6161                     ; 1911         stored_mqttserveraddr[1] != Pending_mqttserveraddr[1] ||
6161                     ; 1912         stored_mqttserveraddr[0] != Pending_mqttserveraddr[0]) {
6163  cb30 c64034        	ld	a,_stored_mqttserveraddr+3
6164  cb33 c10162        	cp	a,_Pending_mqttserveraddr+3
6165  cb36 2618          	jrne	L7603
6167  cb38 c64033        	ld	a,_stored_mqttserveraddr+2
6168  cb3b c10161        	cp	a,_Pending_mqttserveraddr+2
6169  cb3e 2610          	jrne	L7603
6171  cb40 c64032        	ld	a,_stored_mqttserveraddr+1
6172  cb43 c10160        	cp	a,_Pending_mqttserveraddr+1
6173  cb46 2608          	jrne	L7603
6175  cb48 c64031        	ld	a,_stored_mqttserveraddr
6176  cb4b c1015f        	cp	a,_Pending_mqttserveraddr
6177  cb4e 2717          	jreq	L5603
6178  cb50               L7603:
6179                     ; 1914       for (i=0; i<4; i++) stored_mqttserveraddr[i] = Pending_mqttserveraddr[i];
6181  cb50 4f            	clr	a
6182  cb51 6b01          	ld	(OFST+0,sp),a
6184  cb53               L5703:
6187  cb53 5f            	clrw	x
6188  cb54 97            	ld	xl,a
6189  cb55 d6015f        	ld	a,(_Pending_mqttserveraddr,x)
6190  cb58 d74031        	ld	(_stored_mqttserveraddr,x),a
6193  cb5b 0c01          	inc	(OFST+0,sp)
6197  cb5d 7b01          	ld	a,(OFST+0,sp)
6198  cb5f a104          	cp	a,#4
6199  cb61 25f0          	jrult	L5703
6200                     ; 1916       restart_request = 1;
6202  cb63 35010109      	mov	_restart_request,#1
6203  cb67               L5603:
6204                     ; 1920     if (stored_mqttport != Pending_mqttport) {
6206  cb67 ce402f        	ldw	x,_stored_mqttport
6207  cb6a c3015d        	cpw	x,_Pending_mqttport
6208  cb6d 270f          	jreq	L3013
6209                     ; 1922       stored_mqttport = Pending_mqttport;
6211  cb6f ce015d        	ldw	x,_Pending_mqttport
6212  cb72 89            	pushw	x
6213  cb73 ae402f        	ldw	x,#_stored_mqttport
6214  cb76 cdf6c2        	call	c_eewrw
6216  cb79 35010109      	mov	_restart_request,#1
6217  cb7d 85            	popw	x
6218                     ; 1924       restart_request = 1;
6220  cb7e               L3013:
6221                     ; 1928     for(i=0; i<11; i++) {
6223  cb7e 4f            	clr	a
6224  cb7f 6b01          	ld	(OFST+0,sp),a
6226  cb81               L5013:
6227                     ; 1929       if (stored_mqtt_username[i] != Pending_mqtt_username[i]) {
6229  cb81 5f            	clrw	x
6230  cb82 97            	ld	xl,a
6231  cb83 905f          	clrw	y
6232  cb85 9097          	ld	yl,a
6233  cb87 90d64035      	ld	a,(_stored_mqtt_username,y)
6234  cb8b d10152        	cp	a,(_Pending_mqtt_username,x)
6235  cb8e 270e          	jreq	L3113
6236                     ; 1930         stored_mqtt_username[i] = Pending_mqtt_username[i];
6238  cb90 7b01          	ld	a,(OFST+0,sp)
6239  cb92 5f            	clrw	x
6240  cb93 97            	ld	xl,a
6241  cb94 d60152        	ld	a,(_Pending_mqtt_username,x)
6242  cb97 d74035        	ld	(_stored_mqtt_username,x),a
6243                     ; 1932         restart_request = 1;
6245  cb9a 35010109      	mov	_restart_request,#1
6246  cb9e               L3113:
6247                     ; 1928     for(i=0; i<11; i++) {
6249  cb9e 0c01          	inc	(OFST+0,sp)
6253  cba0 7b01          	ld	a,(OFST+0,sp)
6254  cba2 a10b          	cp	a,#11
6255  cba4 25db          	jrult	L5013
6256                     ; 1937     for(i=0; i<11; i++) {
6258  cba6 4f            	clr	a
6259  cba7 6b01          	ld	(OFST+0,sp),a
6261  cba9               L5113:
6262                     ; 1938       if (stored_mqtt_password[i] != Pending_mqtt_password[i]) {
6264  cba9 5f            	clrw	x
6265  cbaa 97            	ld	xl,a
6266  cbab 905f          	clrw	y
6267  cbad 9097          	ld	yl,a
6268  cbaf 90d64040      	ld	a,(_stored_mqtt_password,y)
6269  cbb3 d10147        	cp	a,(_Pending_mqtt_password,x)
6270  cbb6 270e          	jreq	L3213
6271                     ; 1939         stored_mqtt_password[i] = Pending_mqtt_password[i];
6273  cbb8 7b01          	ld	a,(OFST+0,sp)
6274  cbba 5f            	clrw	x
6275  cbbb 97            	ld	xl,a
6276  cbbc d60147        	ld	a,(_Pending_mqtt_password,x)
6277  cbbf d74040        	ld	(_stored_mqtt_password,x),a
6278                     ; 1941         restart_request = 1;
6280  cbc2 35010109      	mov	_restart_request,#1
6281  cbc6               L3213:
6282                     ; 1937     for(i=0; i<11; i++) {
6284  cbc6 0c01          	inc	(OFST+0,sp)
6288  cbc8 7b01          	ld	a,(OFST+0,sp)
6289  cbca a10b          	cp	a,#11
6290  cbcc 25db          	jrult	L5113
6291                     ; 1947     if (stored_uip_ethaddr_oct[0] != Pending_uip_ethaddr_oct[0] ||
6291                     ; 1948       stored_uip_ethaddr_oct[1] != Pending_uip_ethaddr_oct[1] ||
6291                     ; 1949       stored_uip_ethaddr_oct[2] != Pending_uip_ethaddr_oct[2] ||
6291                     ; 1950       stored_uip_ethaddr_oct[3] != Pending_uip_ethaddr_oct[3] ||
6291                     ; 1951       stored_uip_ethaddr_oct[4] != Pending_uip_ethaddr_oct[4] ||
6291                     ; 1952       stored_uip_ethaddr_oct[5] != Pending_uip_ethaddr_oct[5]) {
6293  cbce c64017        	ld	a,_stored_uip_ethaddr_oct
6294  cbd1 c10119        	cp	a,_Pending_uip_ethaddr_oct
6295  cbd4 2628          	jrne	L7213
6297  cbd6 c64018        	ld	a,_stored_uip_ethaddr_oct+1
6298  cbd9 c1011a        	cp	a,_Pending_uip_ethaddr_oct+1
6299  cbdc 2620          	jrne	L7213
6301  cbde c64019        	ld	a,_stored_uip_ethaddr_oct+2
6302  cbe1 c1011b        	cp	a,_Pending_uip_ethaddr_oct+2
6303  cbe4 2618          	jrne	L7213
6305  cbe6 c6401a        	ld	a,_stored_uip_ethaddr_oct+3
6306  cbe9 c1011c        	cp	a,_Pending_uip_ethaddr_oct+3
6307  cbec 2610          	jrne	L7213
6309  cbee c6401b        	ld	a,_stored_uip_ethaddr_oct+4
6310  cbf1 c1011d        	cp	a,_Pending_uip_ethaddr_oct+4
6311  cbf4 2608          	jrne	L7213
6313  cbf6 c6401c        	ld	a,_stored_uip_ethaddr_oct+5
6314  cbf9 c1011e        	cp	a,_Pending_uip_ethaddr_oct+5
6315  cbfc 271a          	jreq	L3572
6316  cbfe               L7213:
6317                     ; 1954       for (i=0; i<6; i++) stored_uip_ethaddr_oct[i] = Pending_uip_ethaddr_oct[i];
6319  cbfe 4f            	clr	a
6320  cbff 6b01          	ld	(OFST+0,sp),a
6322  cc01               L1413:
6325  cc01 5f            	clrw	x
6326  cc02 97            	ld	xl,a
6327  cc03 d60119        	ld	a,(_Pending_uip_ethaddr_oct,x)
6328  cc06 d74017        	ld	(_stored_uip_ethaddr_oct,x),a
6331  cc09 0c01          	inc	(OFST+0,sp)
6335  cc0b 7b01          	ld	a,(OFST+0,sp)
6336  cc0d a106          	cp	a,#6
6337  cc0f 25f0          	jrult	L1413
6338                     ; 1956       update_mac_string();
6340  cc11 cdc904        	call	_update_mac_string
6342                     ; 1958       restart_request = 1;
6344  cc14 35010109      	mov	_restart_request,#1
6345  cc18               L3572:
6346                     ; 1962   if (restart_request == 1) {
6348  cc18 c60109        	ld	a,_restart_request
6349  cc1b 4a            	dec	a
6350  cc1c 2609          	jrne	L7413
6351                     ; 1965     if (restart_reboot_step == RESTART_REBOOT_IDLE) {
6353  cc1e c60108        	ld	a,_restart_reboot_step
6354  cc21 2604          	jrne	L7413
6355                     ; 1966       restart_reboot_step = RESTART_REBOOT_ARM;
6357  cc23 35010108      	mov	_restart_reboot_step,#1
6358  cc27               L7413:
6359                     ; 1970   if (user_reboot_request == 1) {
6361  cc27 c6010a        	ld	a,_user_reboot_request
6362  cc2a 4a            	dec	a
6363  cc2b 2611          	jrne	L3513
6364                     ; 1973     if (restart_reboot_step == RESTART_REBOOT_IDLE) {
6366  cc2d 725d0108      	tnz	_restart_reboot_step
6367  cc31 260b          	jrne	L3513
6368                     ; 1974       restart_reboot_step = RESTART_REBOOT_ARM;
6370  cc33 35010108      	mov	_restart_reboot_step,#1
6371                     ; 1975       user_reboot_request = 0;
6373  cc37 c7010a        	ld	_user_reboot_request,a
6374                     ; 1976       reboot_request = 1;
6376  cc3a 3501010b      	mov	_reboot_request,#1
6377  cc3e               L3513:
6378                     ; 1985   parse_complete = 0; // Reset parse_complete for future changes
6380  cc3e 725f0106      	clr	_parse_complete
6381                     ; 1988   if (stack_limit1 != 0xaa || stack_limit2 != 0x55) {
6383  cc42 c605ff        	ld	a,_stack_limit1
6384  cc45 a1aa          	cp	a,#170
6385  cc47 2607          	jrne	L1613
6387  cc49 c605fe        	ld	a,_stack_limit2
6388  cc4c a155          	cp	a,#85
6389  cc4e 270a          	jreq	L7513
6390  cc50               L1613:
6391                     ; 1989     stack_error = 1;
6393  cc50 35010163      	mov	_stack_error,#1
6394                     ; 1990     fastflash();
6396  cc54 cdcf7e        	call	_fastflash
6398                     ; 1991     fastflash();
6400  cc57 cdcf7e        	call	_fastflash
6402  cc5a               L7513:
6403                     ; 2004 }
6406  cc5a 84            	pop	a
6407  cc5b 81            	ret	
6442                     ; 2007 void check_restart_reboot(void)
6442                     ; 2008 {
6443                     .text:	section	.text,new
6444  cc5c               _check_restart_reboot:
6448                     ; 2014   if (restart_request == 1 || reboot_request == 1) {
6450  cc5c c60109        	ld	a,_restart_request
6451  cc5f 4a            	dec	a
6452  cc60 2709          	jreq	L5713
6454  cc62 c6010b        	ld	a,_reboot_request
6455  cc65 4a            	dec	a
6456  cc66 2703cccd30    	jrne	L3713
6457  cc6b               L5713:
6458                     ; 2025     if (restart_reboot_step == RESTART_REBOOT_ARM) {
6460  cc6b c60108        	ld	a,_restart_reboot_step
6461  cc6e a101          	cp	a,#1
6462  cc70 2611          	jrne	L7713
6463                     ; 2030       time_mark2 = second_counter;
6465  cc72 ce029e        	ldw	x,_second_counter+2
6466  cc75 cf00fd        	ldw	_time_mark2+2,x
6467  cc78 ce029c        	ldw	x,_second_counter
6468  cc7b cf00fb        	ldw	_time_mark2,x
6469                     ; 2031       restart_reboot_step = RESTART_REBOOT_ARM2;
6471  cc7e 35020108      	mov	_restart_reboot_step,#2
6474  cc82 81            	ret	
6475  cc83               L7713:
6476                     ; 2034     else if (restart_reboot_step == RESTART_REBOOT_ARM2) {
6478  cc83 a102          	cp	a,#2
6479  cc85 2613          	jrne	L3023
6480                     ; 2040       if (second_counter > time_mark2 + 0 ) {
6482  cc87 ae029c        	ldw	x,#_second_counter
6483  cc8a cdf935        	call	c_ltor
6485  cc8d ae00fb        	ldw	x,#_time_mark2
6486  cc90 cdf8ca        	call	c_lcmp
6488  cc93 23d3          	jrule	L3713
6489                     ; 2041         restart_reboot_step = RESTART_REBOOT_DISCONNECT;
6491  cc95 35030108      	mov	_restart_reboot_step,#3
6493  cc99 81            	ret	
6494  cc9a               L3023:
6495                     ; 2046     else if (restart_reboot_step == RESTART_REBOOT_DISCONNECT) {
6497  cc9a a103          	cp	a,#3
6498  cc9c 261e          	jrne	L1123
6499                     ; 2047       restart_reboot_step = RESTART_REBOOT_DISCONNECTWAIT;
6501  cc9e 35040108      	mov	_restart_reboot_step,#4
6502                     ; 2048       if (mqtt_start == MQTT_START_COMPLETE) {
6504  cca2 c600a8        	ld	a,_mqtt_start
6505  cca5 a114          	cp	a,#20
6506  cca7 2606          	jrne	L3123
6507                     ; 2050         mqtt_disconnect(&mqttclient);
6509  cca9 ae00c5        	ldw	x,#_mqttclient
6510  ccac cdd483        	call	_mqtt_disconnect
6512  ccaf               L3123:
6513                     ; 2053       time_mark2 = second_counter;
6515  ccaf ce029e        	ldw	x,_second_counter+2
6516  ccb2 cf00fd        	ldw	_time_mark2+2,x
6517  ccb5 ce029c        	ldw	x,_second_counter
6518  ccb8 cf00fb        	ldw	_time_mark2,x
6521  ccbb 81            	ret	
6522  ccbc               L1123:
6523                     ; 2056     else if (restart_reboot_step == RESTART_REBOOT_DISCONNECTWAIT) {
6525  ccbc a104          	cp	a,#4
6526  ccbe 2618          	jrne	L7123
6527                     ; 2057       if (second_counter > time_mark2 + 1 ) {
6529  ccc0 ae00fb        	ldw	x,#_time_mark2
6530  ccc3 cdf935        	call	c_ltor
6532  ccc6 a601          	ld	a,#1
6533  ccc8 cdf8a1        	call	c_ladc
6535  cccb ae029c        	ldw	x,#_second_counter
6536  ccce cdf8ca        	call	c_lcmp
6538  ccd1 245d          	jruge	L3713
6539                     ; 2060         restart_reboot_step = RESTART_REBOOT_TCPCLOSE;
6541  ccd3 35050108      	mov	_restart_reboot_step,#5
6543  ccd7 81            	ret	
6544  ccd8               L7123:
6545                     ; 2064     else if (restart_reboot_step == RESTART_REBOOT_TCPCLOSE) {
6547  ccd8 a105          	cp	a,#5
6548  ccda 2615          	jrne	L5223
6549                     ; 2080       mqtt_close_tcp = 1;
6551  ccdc 35010107      	mov	_mqtt_close_tcp,#1
6552                     ; 2082       time_mark2 = second_counter;
6554  cce0 ce029e        	ldw	x,_second_counter+2
6555  cce3 cf00fd        	ldw	_time_mark2+2,x
6556  cce6 ce029c        	ldw	x,_second_counter
6557  cce9 cf00fb        	ldw	_time_mark2,x
6558                     ; 2083       restart_reboot_step = RESTART_REBOOT_TCPWAIT;
6560  ccec 35060108      	mov	_restart_reboot_step,#6
6563  ccf0 81            	ret	
6564  ccf1               L5223:
6565                     ; 2085     else if (restart_reboot_step == RESTART_REBOOT_TCPWAIT) {
6567  ccf1 a106          	cp	a,#6
6568  ccf3 261c          	jrne	L1323
6569                     ; 2090       if (second_counter > time_mark2 + 1) {
6571  ccf5 ae00fb        	ldw	x,#_time_mark2
6572  ccf8 cdf935        	call	c_ltor
6574  ccfb a601          	ld	a,#1
6575  ccfd cdf8a1        	call	c_ladc
6577  cd00 ae029c        	ldw	x,#_second_counter
6578  cd03 cdf8ca        	call	c_lcmp
6580  cd06 2428          	jruge	L3713
6581                     ; 2091 	mqtt_close_tcp = 0;
6583  cd08 725f0107      	clr	_mqtt_close_tcp
6584                     ; 2092         restart_reboot_step = RESTART_REBOOT_FINISH;
6586  cd0c 35070108      	mov	_restart_reboot_step,#7
6588  cd10 81            	ret	
6589  cd11               L1323:
6590                     ; 2102     else if (restart_reboot_step == RESTART_REBOOT_FINISH) {
6592  cd11 a107          	cp	a,#7
6593  cd13 261b          	jrne	L3713
6594                     ; 2103       if (reboot_request == 1) {
6596  cd15 c6010b        	ld	a,_reboot_request
6597  cd18 4a            	dec	a
6598  cd19 2606          	jrne	L1423
6599                     ; 2104         restart_reboot_step = RESTART_REBOOT_IDLE;
6601  cd1b c70108        	ld	_restart_reboot_step,a
6602                     ; 2106         reboot();
6604  cd1e cdcdb1        	call	_reboot
6606  cd21               L1423:
6607                     ; 2108       if (restart_request == 1) {
6609  cd21 c60109        	ld	a,_restart_request
6610  cd24 4a            	dec	a
6611  cd25 2609          	jrne	L3713
6612                     ; 2109 	restart_request = 0;
6614  cd27 c70109        	ld	_restart_request,a
6615                     ; 2110         restart_reboot_step = RESTART_REBOOT_IDLE;
6617  cd2a c70108        	ld	_restart_reboot_step,a
6618                     ; 2112 	restart();
6620  cd2d cdcd31        	call	_restart
6622  cd30               L3713:
6623                     ; 2116 }
6626  cd30 81            	ret	
6679                     ; 2119 void restart(void)
6679                     ; 2120 {
6680                     .text:	section	.text,new
6681  cd31               _restart:
6685                     ; 2134   LEDcontrol(0); // Turn LED off
6687  cd31 4f            	clr	a
6688  cd32 cda464        	call	_LEDcontrol
6690                     ; 2136   parse_complete = 0;
6692  cd35 725f0106      	clr	_parse_complete
6693                     ; 2137   reboot_request = 0;
6695  cd39 725f010b      	clr	_reboot_request
6696                     ; 2138   restart_request = 0;
6698  cd3d 725f0109      	clr	_restart_request
6699                     ; 2140   time_mark2 = 0;           // Time capture used in reboot
6701  cd41 5f            	clrw	x
6702  cd42 cf00fd        	ldw	_time_mark2+2,x
6703  cd45 cf00fb        	ldw	_time_mark2,x
6704                     ; 2143   mqtt_close_tcp = 0;
6706  cd48 725f0107      	clr	_mqtt_close_tcp
6707                     ; 2145   mqtt_start = MQTT_START_TCP_CONNECT;
6709  cd4c 350100a8      	mov	_mqtt_start,#1
6710                     ; 2146   mqtt_start_status = MQTT_START_NOT_STARTED;
6712  cd50 725f00a7      	clr	_mqtt_start_status
6713                     ; 2147   mqtt_start_ctr1 = 0;
6715  cd54 725f00a6      	clr	_mqtt_start_ctr1
6716                     ; 2148   mqtt_sanity_ctr = 0;
6718  cd58 725f00a4      	clr	_mqtt_sanity_ctr
6719                     ; 2149   mqtt_start_retry = 0;
6721  cd5c 725f00a3      	clr	_mqtt_start_retry
6722                     ; 2150   MQTT_error_status = 0;
6724  cd60 725f029b      	clr	_MQTT_error_status
6725                     ; 2151   mqtt_restart_step = MQTT_RESTART_IDLE;
6727  cd64 725f00a0      	clr	_mqtt_restart_step
6728                     ; 2152   strcpy(topic_base, devicetype);
6730  cd68 ae0074        	ldw	x,#_topic_base
6731  cd6b 90ae9e68      	ldw	y,#L5261_devicetype
6732  cd6f               L433:
6733  cd6f 90f6          	ld	a,(y)
6734  cd71 905c          	incw	y
6735  cd73 f7            	ld	(x),a
6736  cd74 5c            	incw	x
6737  cd75 4d            	tnz	a
6738  cd76 26f7          	jrne	L433
6739                     ; 2153   state_request = STATE_REQUEST_IDLE;
6741  cd78 c70164        	ld	_state_request,a
6742                     ; 2156   spi_init();              // Initialize the SPI bit bang interface to the
6744  cd7b cde488        	call	_spi_init
6746                     ; 2158   unlock_eeprom();         // unlock the EEPROM so writes can be performed
6748  cd7e cdc439        	call	_unlock_eeprom
6750                     ; 2159   check_eeprom_settings(); // Verify EEPROM up to date
6752  cd81 cdc449        	call	_check_eeprom_settings
6754                     ; 2160   Enc28j60Init();          // Initialize the ENC28J60 ethernet interface
6756  cd84 cda024        	call	_Enc28j60Init
6758                     ; 2161   uip_arp_init();          // Initialize the ARP module
6760  cd87 cdf1f1        	call	_uip_arp_init
6762                     ; 2162   uip_init();              // Initialize uIP
6764  cd8a cde78e        	call	_uip_init
6766                     ; 2163   HttpDInit();             // Initialize httpd; sets up listening ports
6768  cd8d cdac89        	call	_HttpDInit
6770                     ; 2167   mqtt_init(&mqttclient,
6770                     ; 2168             mqtt_sendbuf,
6770                     ; 2169 	    sizeof(mqtt_sendbuf),
6770                     ; 2170 	    &uip_buf[UIP_IPTCPH_LEN + UIP_LLH_LEN],
6770                     ; 2171 	    UIP_APPDATA_SIZE,
6770                     ; 2172 	    publish_callback);
6772  cd90 aec1a1        	ldw	x,#_publish_callback
6773  cd93 89            	pushw	x
6774  cd94 ae01be        	ldw	x,#446
6775  cd97 89            	pushw	x
6776  cd98 ae03a9        	ldw	x,#_uip_buf+54
6777  cd9b 89            	pushw	x
6778  cd9c ae00c8        	ldw	x,#200
6779  cd9f 89            	pushw	x
6780  cda0 ae016f        	ldw	x,#_mqtt_sendbuf
6781  cda3 89            	pushw	x
6782  cda4 ae00c5        	ldw	x,#_mqttclient
6783  cda7 cdd030        	call	_mqtt_init
6785  cdaa 5b0a          	addw	sp,#10
6786                     ; 2175   LEDcontrol(1); // Turn LED on
6788  cdac a601          	ld	a,#1
6790                     ; 2178 }
6793  cdae cca464        	jp	_LEDcontrol
6821                     ; 2181 void reboot(void)
6821                     ; 2182 {
6822                     .text:	section	.text,new
6823  cdb1               _reboot:
6827                     ; 2185   fastflash(); // A useful signal that a deliberate reboot is occurring.
6829  cdb1 cdcf7e        	call	_fastflash
6831                     ; 2187   LEDcontrol(0);  // turn LED off
6833  cdb4 4f            	clr	a
6834  cdb5 cda464        	call	_LEDcontrol
6836                     ; 2189   WWDG_WR = (uint8_t)0x7f;     // Window register reset
6838  cdb8 357f50d2      	mov	_WWDG_WR,#127
6839                     ; 2190   WWDG_CR = (uint8_t)0xff;     // Set watchdog to timeout in 49ms
6841  cdbc 35ff50d1      	mov	_WWDG_CR,#255
6842                     ; 2191   WWDG_WR = (uint8_t)0x60;     // Window register value - doesn't matter
6844  cdc0 356050d2      	mov	_WWDG_WR,#96
6845                     ; 2194   wait_timer((uint16_t)50000); // Wait for watchdog to generate reset
6847  cdc4 aec350        	ldw	x,#50000
6848  cdc7 cde65b        	call	_wait_timer
6850                     ; 2195   wait_timer((uint16_t)50000);
6852  cdca aec350        	ldw	x,#50000
6853  cdcd cde65b        	call	_wait_timer
6855                     ; 2196   wait_timer((uint16_t)50000);
6857  cdd0 aec350        	ldw	x,#50000
6859                     ; 2197 }
6862  cdd3 cce65b        	jp	_wait_timer
6903                     ; 2200 void read_input_registers(void)
6903                     ; 2201 {
6904                     .text:	section	.text,new
6905  cdd6               _read_input_registers:
6907  cdd6 89            	pushw	x
6908       00000002      OFST:	set	2
6911                     ; 2218   if (PC_IDR & (uint8_t)0x40) IO_16to9_new1 |= 0x80; // PC bit 6 = 1, Input 8 = 1
6913  cdd7 720d500b06    	btjf	_PC_IDR,#6,L1033
6916  cddc 721e016c      	bset	_IO_16to9_new1,#7
6918  cde0 2004          	jra	L3033
6919  cde2               L1033:
6920                     ; 2219   else IO_16to9_new1 &= (uint8_t)(~0x80);
6922  cde2 721f016c      	bres	_IO_16to9_new1,#7
6923  cde6               L3033:
6924                     ; 2220   if (PG_IDR & (uint8_t)0x01) IO_16to9_new1 |= 0x40; // PG bit 0 = 1, Input 7 = 1
6926  cde6 7201501f06    	btjf	_PG_IDR,#0,L5033
6929  cdeb 721c016c      	bset	_IO_16to9_new1,#6
6931  cdef 2004          	jra	L7033
6932  cdf1               L5033:
6933                     ; 2221   else IO_16to9_new1 &= (uint8_t)(~0x40);
6935  cdf1 721d016c      	bres	_IO_16to9_new1,#6
6936  cdf5               L7033:
6937                     ; 2222   if (PE_IDR & (uint8_t)0x08) IO_16to9_new1 |= 0x20; // PE bit 3 = 1, Input 6 = 1
6939  cdf5 7207501506    	btjf	_PE_IDR,#3,L1133
6942  cdfa 721a016c      	bset	_IO_16to9_new1,#5
6944  cdfe 2004          	jra	L3133
6945  ce00               L1133:
6946                     ; 2223   else IO_16to9_new1 &= (uint8_t)(~0x20);
6948  ce00 721b016c      	bres	_IO_16to9_new1,#5
6949  ce04               L3133:
6950                     ; 2224   if (PD_IDR & (uint8_t)0x01) IO_16to9_new1 |= 0x10; // PD bit 0 = 1, Input 5 = 1
6952  ce04 7201501006    	btjf	_PD_IDR,#0,L5133
6955  ce09 7218016c      	bset	_IO_16to9_new1,#4
6957  ce0d 2004          	jra	L7133
6958  ce0f               L5133:
6959                     ; 2225   else IO_16to9_new1 &= (uint8_t)(~0x10);
6961  ce0f 7219016c      	bres	_IO_16to9_new1,#4
6962  ce13               L7133:
6963                     ; 2226   if (PD_IDR & (uint8_t)0x08) IO_16to9_new1 |= 0x08; // PD bit 3 = 1, Input 4 = 1
6965  ce13 7207501006    	btjf	_PD_IDR,#3,L1233
6968  ce18 7216016c      	bset	_IO_16to9_new1,#3
6970  ce1c 2004          	jra	L3233
6971  ce1e               L1233:
6972                     ; 2227   else IO_16to9_new1 &= (uint8_t)(~0x08);
6974  ce1e 7217016c      	bres	_IO_16to9_new1,#3
6975  ce22               L3233:
6976                     ; 2228   if (PD_IDR & (uint8_t)0x20) IO_16to9_new1 |= 0x04; // PD bit 5 = 1, Input 3 = 1
6978  ce22 720b501006    	btjf	_PD_IDR,#5,L5233
6981  ce27 7214016c      	bset	_IO_16to9_new1,#2
6983  ce2b 2004          	jra	L7233
6984  ce2d               L5233:
6985                     ; 2229   else IO_16to9_new1 &= (uint8_t)(~0x04);
6987  ce2d 7215016c      	bres	_IO_16to9_new1,#2
6988  ce31               L7233:
6989                     ; 2230   if (PD_IDR & (uint8_t)0x80) IO_16to9_new1 |= 0x02; // PD bit 7 = 1, Input 2 = 1
6991  ce31 720f501006    	btjf	_PD_IDR,#7,L1333
6994  ce36 7212016c      	bset	_IO_16to9_new1,#1
6996  ce3a 2004          	jra	L3333
6997  ce3c               L1333:
6998                     ; 2231   else IO_16to9_new1 &= (uint8_t)(~0x02);
7000  ce3c 7213016c      	bres	_IO_16to9_new1,#1
7001  ce40               L3333:
7002                     ; 2232   if (PA_IDR & (uint8_t)0x10) IO_16to9_new1 |= 0x01; // PA bit 4 = 1, Input 1 = 1
7004  ce40 7209500106    	btjf	_PA_IDR,#4,L5333
7007  ce45 7210016c      	bset	_IO_16to9_new1,#0
7009  ce49 2004          	jra	L7333
7010  ce4b               L5333:
7011                     ; 2233   else IO_16to9_new1 &= (uint8_t)(~0x01);
7013  ce4b 7211016c      	bres	_IO_16to9_new1,#0
7014  ce4f               L7333:
7015                     ; 2238   xor_tmp = (uint8_t)((IO_16to9 ^ IO_16to9_new1) & (IO_16to9 ^ IO_16to9_new2));
7017  ce4f c6016e        	ld	a,_IO_16to9
7018  ce52 c8016a        	xor	a,_IO_16to9_new2
7019  ce55 6b01          	ld	(OFST-1,sp),a
7021  ce57 c6016e        	ld	a,_IO_16to9
7022  ce5a c8016c        	xor	a,_IO_16to9_new1
7023  ce5d 1401          	and	a,(OFST-1,sp)
7024  ce5f 6b02          	ld	(OFST+0,sp),a
7026                     ; 2239   IO_16to9 = (uint8_t)(IO_16to9 ^ xor_tmp);
7028  ce61 c8016e        	xor	a,_IO_16to9
7029  ce64 c7016e        	ld	_IO_16to9,a
7030                     ; 2241   IO_16to9_new2 = IO_16to9_new1;
7032                     ; 2295 }
7035  ce67 85            	popw	x
7036  ce68 55016c016a    	mov	_IO_16to9_new2,_IO_16to9_new1
7037  ce6d 81            	ret	
7077                     ; 2298 void write_output_registers(void)
7077                     ; 2299 {
7078                     .text:	section	.text,new
7079  ce6e               _write_output_registers:
7081  ce6e 88            	push	a
7082       00000001      OFST:	set	1
7085                     ; 2353   xor_tmp = (uint8_t)(invert_output ^ IO_8to1);
7087  ce6f c60166        	ld	a,_invert_output
7088  ce72 c8016d        	xor	a,_IO_8to1
7089  ce75 6b01          	ld	(OFST+0,sp),a
7091                     ; 2354   if (xor_tmp & 0x80) PC_ODR |= (uint8_t)0x80; // Relay 8 off
7093  ce77 2a06          	jrpl	L5533
7096  ce79 721e500a      	bset	_PC_ODR,#7
7098  ce7d 2004          	jra	L7533
7099  ce7f               L5533:
7100                     ; 2355   else PC_ODR &= (uint8_t)~0x80; // Relay 8 on
7102  ce7f 721f500a      	bres	_PC_ODR,#7
7103  ce83               L7533:
7104                     ; 2356   if (xor_tmp & 0x40) PG_ODR |= (uint8_t)0x02; // Relay 7 off
7106  ce83 a540          	bcp	a,#64
7107  ce85 2706          	jreq	L1633
7110  ce87 7212501e      	bset	_PG_ODR,#1
7112  ce8b 2004          	jra	L3633
7113  ce8d               L1633:
7114                     ; 2357   else PG_ODR &= (uint8_t)~0x02; // Relay 7 on
7116  ce8d 7213501e      	bres	_PG_ODR,#1
7117  ce91               L3633:
7118                     ; 2358   if (xor_tmp & 0x20) PE_ODR |= (uint8_t)0x01; // Relay 6 off
7120  ce91 7b01          	ld	a,(OFST+0,sp)
7121  ce93 a520          	bcp	a,#32
7122  ce95 2706          	jreq	L5633
7125  ce97 72105014      	bset	_PE_ODR,#0
7127  ce9b 2004          	jra	L7633
7128  ce9d               L5633:
7129                     ; 2359   else PE_ODR &= (uint8_t)~0x01; // Relay 6 on
7131  ce9d 72115014      	bres	_PE_ODR,#0
7132  cea1               L7633:
7133                     ; 2360   if (xor_tmp & 0x10) PD_ODR |= (uint8_t)0x04; // Relay 5 off
7135  cea1 a510          	bcp	a,#16
7136  cea3 2706          	jreq	L1733
7139  cea5 7214500f      	bset	_PD_ODR,#2
7141  cea9 2004          	jra	L3733
7142  ceab               L1733:
7143                     ; 2361   else PD_ODR &= (uint8_t)~0x04; // Relay 5 on
7145  ceab 7215500f      	bres	_PD_ODR,#2
7146  ceaf               L3733:
7147                     ; 2362   if (xor_tmp & 0x08) PD_ODR |= (uint8_t)0x10; // Relay 4 off
7149  ceaf 7b01          	ld	a,(OFST+0,sp)
7150  ceb1 a508          	bcp	a,#8
7151  ceb3 2706          	jreq	L5733
7154  ceb5 7218500f      	bset	_PD_ODR,#4
7156  ceb9 2004          	jra	L7733
7157  cebb               L5733:
7158                     ; 2363   else PD_ODR &= (uint8_t)~0x10; // Relay 4 on
7160  cebb 7219500f      	bres	_PD_ODR,#4
7161  cebf               L7733:
7162                     ; 2364   if (xor_tmp & 0x04) PD_ODR |= (uint8_t)0x40; // Relay 3 off
7164  cebf a504          	bcp	a,#4
7165  cec1 2706          	jreq	L1043
7168  cec3 721c500f      	bset	_PD_ODR,#6
7170  cec7 2004          	jra	L3043
7171  cec9               L1043:
7172                     ; 2365   else PD_ODR &= (uint8_t)~0x40; // Relay 3 on
7174  cec9 721d500f      	bres	_PD_ODR,#6
7175  cecd               L3043:
7176                     ; 2366   if (xor_tmp & 0x02) PA_ODR |= (uint8_t)0x20; // Relay 2 off
7178  cecd 7b01          	ld	a,(OFST+0,sp)
7179  cecf a502          	bcp	a,#2
7180  ced1 2706          	jreq	L5043
7183  ced3 721a5000      	bset	_PA_ODR,#5
7185  ced7 2004          	jra	L7043
7186  ced9               L5043:
7187                     ; 2367   else PA_ODR &= (uint8_t)~0x20; // Relay 2 on
7189  ced9 721b5000      	bres	_PA_ODR,#5
7190  cedd               L7043:
7191                     ; 2368   if (xor_tmp & 0x01) PA_ODR |= (uint8_t)0x08; // Relay 1 off
7193  cedd a501          	bcp	a,#1
7194  cedf 2706          	jreq	L1143
7197  cee1 72165000      	bset	_PA_ODR,#3
7199  cee5 2004          	jra	L3143
7200  cee7               L1143:
7201                     ; 2369   else PA_ODR &= (uint8_t)~0x08; // Relay 1 on
7203  cee7 72175000      	bres	_PA_ODR,#3
7204  ceeb               L3143:
7205                     ; 2375 }
7208  ceeb 84            	pop	a
7209  ceec 81            	ret	
7250                     ; 2378 void check_reset_button(void)
7250                     ; 2379 {
7251                     .text:	section	.text,new
7252  ceed               _check_reset_button:
7254  ceed 88            	push	a
7255       00000001      OFST:	set	1
7258                     ; 2384   if ((PA_IDR & 0x02) == 0) {
7260  ceee 720250015d    	btjt	_PA_IDR,#1,L1343
7261                     ; 2386     for (i=0; i<100; i++) {
7263  cef3 0f01          	clr	(OFST+0,sp)
7265  cef5               L3343:
7266                     ; 2387       wait_timer(50000); // wait 50ms
7268  cef5 aec350        	ldw	x,#50000
7269  cef8 cde65b        	call	_wait_timer
7271                     ; 2388       if ((PA_IDR & 0x02) == 1) { // check Reset Button again. If released
7273  cefb c65001        	ld	a,_PA_IDR
7274  cefe a402          	and	a,#2
7275  cf00 4a            	dec	a
7276  cf01 2602          	jrne	L1443
7277                     ; 2390         return;
7280  cf03 84            	pop	a
7281  cf04 81            	ret	
7282  cf05               L1443:
7283                     ; 2386     for (i=0; i<100; i++) {
7285  cf05 0c01          	inc	(OFST+0,sp)
7289  cf07 7b01          	ld	a,(OFST+0,sp)
7290  cf09 a164          	cp	a,#100
7291  cf0b 25e8          	jrult	L3343
7292                     ; 2395     LEDcontrol(0);  // turn LED off
7294  cf0d 4f            	clr	a
7295  cf0e cda464        	call	_LEDcontrol
7298  cf11               L5443:
7299                     ; 2396     while((PA_IDR & 0x02) == 0) {  // Wait for button release
7301  cf11 72035001fb    	btjf	_PA_IDR,#1,L5443
7302                     ; 2399     magic4 = 0x00;
7304  cf16 4f            	clr	a
7305  cf17 ae402e        	ldw	x,#_magic4
7306  cf1a cdf6d8        	call	c_eewrc
7308                     ; 2400     magic3 = 0x00;
7310  cf1d 4f            	clr	a
7311  cf1e ae402d        	ldw	x,#_magic3
7312  cf21 cdf6d8        	call	c_eewrc
7314                     ; 2401     magic2 = 0x00;
7316  cf24 4f            	clr	a
7317  cf25 ae402c        	ldw	x,#_magic2
7318  cf28 cdf6d8        	call	c_eewrc
7320                     ; 2402     magic1 = 0x00;
7322  cf2b 4f            	clr	a
7323  cf2c ae402b        	ldw	x,#_magic1
7324  cf2f cdf6d8        	call	c_eewrc
7326                     ; 2404     WWDG_WR = (uint8_t)0x7f;       // Window register reset
7328  cf32 357f50d2      	mov	_WWDG_WR,#127
7329                     ; 2405     WWDG_CR = (uint8_t)0xff;       // Set watchdog to timeout in 49ms
7331  cf36 35ff50d1      	mov	_WWDG_CR,#255
7332                     ; 2406     WWDG_WR = (uint8_t)0x60;       // Window register value - doesn't matter
7334  cf3a 356050d2      	mov	_WWDG_WR,#96
7335                     ; 2409     wait_timer((uint16_t)50000);   // Wait for watchdog to generate reset
7337  cf3e aec350        	ldw	x,#50000
7338  cf41 cde65b        	call	_wait_timer
7340                     ; 2410     wait_timer((uint16_t)50000);
7342  cf44 aec350        	ldw	x,#50000
7343  cf47 cde65b        	call	_wait_timer
7345                     ; 2411     wait_timer((uint16_t)50000);
7347  cf4a aec350        	ldw	x,#50000
7348  cf4d cde65b        	call	_wait_timer
7350  cf50               L1343:
7351                     ; 2413 }
7354  cf50 84            	pop	a
7355  cf51 81            	ret	
7389                     ; 2416 void debugflash(void)
7389                     ; 2417 {
7390                     .text:	section	.text,new
7391  cf52               _debugflash:
7393  cf52 88            	push	a
7394       00000001      OFST:	set	1
7397                     ; 2432   LEDcontrol(0);     // turn LED off
7399  cf53 4f            	clr	a
7400  cf54 cda464        	call	_LEDcontrol
7402                     ; 2433   for(i=0; i<10; i++) wait_timer((uint16_t)50000); // wait 500ms
7404  cf57 0f01          	clr	(OFST+0,sp)
7406  cf59               L5643:
7409  cf59 aec350        	ldw	x,#50000
7410  cf5c cde65b        	call	_wait_timer
7414  cf5f 0c01          	inc	(OFST+0,sp)
7418  cf61 7b01          	ld	a,(OFST+0,sp)
7419  cf63 a10a          	cp	a,#10
7420  cf65 25f2          	jrult	L5643
7421                     ; 2435   LEDcontrol(1);     // turn LED on
7423  cf67 a601          	ld	a,#1
7424  cf69 cda464        	call	_LEDcontrol
7426                     ; 2436   for(i=0; i<10; i++) wait_timer((uint16_t)50000); // wait 500ms
7428  cf6c 0f01          	clr	(OFST+0,sp)
7430  cf6e               L3743:
7433  cf6e aec350        	ldw	x,#50000
7434  cf71 cde65b        	call	_wait_timer
7438  cf74 0c01          	inc	(OFST+0,sp)
7442  cf76 7b01          	ld	a,(OFST+0,sp)
7443  cf78 a10a          	cp	a,#10
7444  cf7a 25f2          	jrult	L3743
7445                     ; 2437 }
7448  cf7c 84            	pop	a
7449  cf7d 81            	ret	
7483                     ; 2440 void fastflash(void)
7483                     ; 2441 {
7484                     .text:	section	.text,new
7485  cf7e               _fastflash:
7487  cf7e 88            	push	a
7488       00000001      OFST:	set	1
7491                     ; 2456   for (i=0; i<10; i++) {
7493  cf7f 0f01          	clr	(OFST+0,sp)
7495  cf81               L5153:
7496                     ; 2457     LEDcontrol(0);     // turn LED off
7498  cf81 4f            	clr	a
7499  cf82 cda464        	call	_LEDcontrol
7501                     ; 2458     wait_timer((uint16_t)50000); // wait 50ms
7503  cf85 aec350        	ldw	x,#50000
7504  cf88 cde65b        	call	_wait_timer
7506                     ; 2460     LEDcontrol(1);     // turn LED on
7508  cf8b a601          	ld	a,#1
7509  cf8d cda464        	call	_LEDcontrol
7511                     ; 2461     wait_timer((uint16_t)50000); // wait 50ms
7513  cf90 aec350        	ldw	x,#50000
7514  cf93 cde65b        	call	_wait_timer
7516                     ; 2456   for (i=0; i<10; i++) {
7518  cf96 0c01          	inc	(OFST+0,sp)
7522  cf98 7b01          	ld	a,(OFST+0,sp)
7523  cf9a a10a          	cp	a,#10
7524  cf9c 25e3          	jrult	L5153
7525                     ; 2463 }
7528  cf9e 84            	pop	a
7529  cf9f 81            	ret	
7554                     ; 2466 void oneflash(void)
7554                     ; 2467 {
7555                     .text:	section	.text,new
7556                     _oneflash:
7560                     ; 2482   LEDcontrol(0);     // turn LED off
7562                     	clr	a
7563                     	call	_LEDcontrol
7565                     ; 2483   wait_timer((uint16_t)25000); // wait 25ms
7567                     	ldw	x,#25000
7568                     	call	_wait_timer
7570                     ; 2485   LEDcontrol(1);     // turn LED on
7572                     	ld	a,#1
7574                     ; 2486 }
7577                     	jp	_LEDcontrol
8905                     	switch	.bss
8906  0067               _TRANSMIT_counter:
8907  0067 00000000      	ds.b	4
8908                     	xdef	_TRANSMIT_counter
8909  006b               _TXERIF_counter:
8910  006b 00000000      	ds.b	4
8911                     	xdef	_TXERIF_counter
8912  006f               _RXERIF_counter:
8913  006f 00000000      	ds.b	4
8914                     	xdef	_RXERIF_counter
8915  0073               _topic_base_len:
8916  0073 00            	ds.b	1
8917                     	xdef	_topic_base_len
8918  0074               _topic_base:
8919  0074 000000000000  	ds.b	44
8920                     	xdef	_topic_base
8921  00a0               _mqtt_restart_step:
8922  00a0 00            	ds.b	1
8923                     	xdef	_mqtt_restart_step
8924                     	xref	_MQTT_error_status
8925  00a1               _mqtt_conn:
8926  00a1 0000          	ds.b	2
8927                     	xdef	_mqtt_conn
8928                     	xref	_mqtt_sendbuf
8929  00a3               _mqtt_start_retry:
8930  00a3 00            	ds.b	1
8931                     	xdef	_mqtt_start_retry
8932  00a4               _mqtt_sanity_ctr:
8933  00a4 00            	ds.b	1
8934                     	xdef	_mqtt_sanity_ctr
8935  00a5               _mqtt_start_ctr2:
8936  00a5 00            	ds.b	1
8937                     	xdef	_mqtt_start_ctr2
8938  00a6               _mqtt_start_ctr1:
8939  00a6 00            	ds.b	1
8940                     	xdef	_mqtt_start_ctr1
8941  00a7               _mqtt_start_status:
8942  00a7 00            	ds.b	1
8943                     	xdef	_mqtt_start_status
8944  00a8               _mqtt_start:
8945  00a8 00            	ds.b	1
8946                     	xdef	_mqtt_start
8947  00a9               _client_id_text:
8948  00a9 000000000000  	ds.b	26
8949                     	xdef	_client_id_text
8950  00c3               _client_id:
8951  00c3 0000          	ds.b	2
8952                     	xdef	_client_id
8953  00c5               _mqttclient:
8954  00c5 000000000000  	ds.b	44
8955                     	xdef	_mqttclient
8956  00f1               _mqtt_keep_alive:
8957  00f1 0000          	ds.b	2
8958                     	xdef	_mqtt_keep_alive
8959  00f3               _application_message:
8960  00f3 000000        	ds.b	3
8961                     	xdef	_application_message
8962  00f6               _Port_Mqttd:
8963  00f6 0000          	ds.b	2
8964                     	xdef	_Port_Mqttd
8965  00f8               _mqttport:
8966  00f8 0000          	ds.b	2
8967                     	xdef	_mqttport
8968  00fa               _connect_flags:
8969  00fa 00            	ds.b	1
8970                     	xdef	_connect_flags
8971                     	xref	_OctetArray
8972                     	xref	_second_counter
8973  00fb               _time_mark2:
8974  00fb 00000000      	ds.b	4
8975                     	xdef	_time_mark2
8976  00ff               _IpAddr:
8977  00ff 00000000      	ds.b	4
8978                     	xdef	_IpAddr
8979  0103               _Port_Httpd:
8980  0103 0000          	ds.b	2
8981                     	xdef	_Port_Httpd
8982  0105               _mqtt_parse_complete:
8983  0105 00            	ds.b	1
8984                     	xdef	_mqtt_parse_complete
8985  0106               _parse_complete:
8986  0106 00            	ds.b	1
8987                     	xdef	_parse_complete
8988  0107               _mqtt_close_tcp:
8989  0107 00            	ds.b	1
8990                     	xdef	_mqtt_close_tcp
8991  0108               _restart_reboot_step:
8992  0108 00            	ds.b	1
8993                     	xdef	_restart_reboot_step
8994  0109               _restart_request:
8995  0109 00            	ds.b	1
8996                     	xdef	_restart_request
8997  010a               _user_reboot_request:
8998  010a 00            	ds.b	1
8999                     	xdef	_user_reboot_request
9000  010b               _reboot_request:
9001  010b 00            	ds.b	1
9002                     	xdef	_reboot_request
9003  010c               _mac_string:
9004  010c 000000000000  	ds.b	13
9005                     	xdef	_mac_string
9006  0119               _Pending_uip_ethaddr_oct:
9007  0119 000000000000  	ds.b	6
9008                     	xdef	_Pending_uip_ethaddr_oct
9009  011f               _Pending_config_settings:
9010  011f 000000000000  	ds.b	6
9011                     	xdef	_Pending_config_settings
9012  0125               _Pending_devicename:
9013  0125 000000000000  	ds.b	20
9014                     	xdef	_Pending_devicename
9015  0139               _Pending_port:
9016  0139 0000          	ds.b	2
9017                     	xdef	_Pending_port
9018  013b               _Pending_netmask:
9019  013b 00000000      	ds.b	4
9020                     	xdef	_Pending_netmask
9021  013f               _Pending_draddr:
9022  013f 00000000      	ds.b	4
9023                     	xdef	_Pending_draddr
9024  0143               _Pending_hostaddr:
9025  0143 00000000      	ds.b	4
9026                     	xdef	_Pending_hostaddr
9027  0147               _Pending_mqtt_password:
9028  0147 000000000000  	ds.b	11
9029                     	xdef	_Pending_mqtt_password
9030  0152               _Pending_mqtt_username:
9031  0152 000000000000  	ds.b	11
9032                     	xdef	_Pending_mqtt_username
9033  015d               _Pending_mqttport:
9034  015d 0000          	ds.b	2
9035                     	xdef	_Pending_mqttport
9036  015f               _Pending_mqttserveraddr:
9037  015f 00000000      	ds.b	4
9038                     	xdef	_Pending_mqttserveraddr
9039  0163               _stack_error:
9040  0163 00            	ds.b	1
9041                     	xdef	_stack_error
9042  0164               _state_request:
9043  0164 00            	ds.b	1
9044                     	xdef	_state_request
9045  0165               _invert_input:
9046  0165 00            	ds.b	1
9047                     	xdef	_invert_input
9048  0166               _invert_output:
9049  0166 00            	ds.b	1
9050                     	xdef	_invert_output
9051  0167               _IO_8to1_sent:
9052  0167 00            	ds.b	1
9053                     	xdef	_IO_8to1_sent
9054  0168               _IO_16to9_sent:
9055  0168 00            	ds.b	1
9056                     	xdef	_IO_16to9_sent
9057  0169               _IO_8to1_new2:
9058  0169 00            	ds.b	1
9059                     	xdef	_IO_8to1_new2
9060  016a               _IO_16to9_new2:
9061  016a 00            	ds.b	1
9062                     	xdef	_IO_16to9_new2
9063  016b               _IO_8to1_new1:
9064  016b 00            	ds.b	1
9065                     	xdef	_IO_8to1_new1
9066  016c               _IO_16to9_new1:
9067  016c 00            	ds.b	1
9068                     	xdef	_IO_16to9_new1
9069  016d               _IO_8to1:
9070  016d 00            	ds.b	1
9071                     	xdef	_IO_8to1
9072  016e               _IO_16to9:
9073  016e 00            	ds.b	1
9074                     	xdef	_IO_16to9
9075                     .eeprom:	section	.data
9076  4000               _stored_devicename:
9077  4000 000000000000  	ds.b	20
9078                     	xdef	_stored_devicename
9079  4014               _stored_IO_8to1:
9080  4014 00            	ds.b	1
9081                     	xdef	_stored_IO_8to1
9082  4015               _stored_unused1:
9083  4015 00            	ds.b	1
9084                     	xdef	_stored_unused1
9085  4016               _stored_unused2:
9086  4016 00            	ds.b	1
9087                     	xdef	_stored_unused2
9088  4017               _stored_uip_ethaddr_oct:
9089  4017 000000000000  	ds.b	6
9090                     	xdef	_stored_uip_ethaddr_oct
9091  401d               _stored_port:
9092  401d 0000          	ds.b	2
9093                     	xdef	_stored_port
9094  401f               _stored_netmask:
9095  401f 00000000      	ds.b	4
9096                     	xdef	_stored_netmask
9097  4023               _stored_draddr:
9098  4023 00000000      	ds.b	4
9099                     	xdef	_stored_draddr
9100  4027               _stored_hostaddr:
9101  4027 00000000      	ds.b	4
9102                     	xdef	_stored_hostaddr
9103  402b               _magic1:
9104  402b 00            	ds.b	1
9105                     	xdef	_magic1
9106  402c               _magic2:
9107  402c 00            	ds.b	1
9108                     	xdef	_magic2
9109  402d               _magic3:
9110  402d 00            	ds.b	1
9111                     	xdef	_magic3
9112  402e               _magic4:
9113  402e 00            	ds.b	1
9114                     	xdef	_magic4
9115  402f               _stored_mqttport:
9116  402f 0000          	ds.b	2
9117                     	xdef	_stored_mqttport
9118  4031               _stored_mqttserveraddr:
9119  4031 00000000      	ds.b	4
9120                     	xdef	_stored_mqttserveraddr
9121  4035               _stored_mqtt_username:
9122  4035 000000000000  	ds.b	11
9123                     	xdef	_stored_mqtt_username
9124  4040               _stored_mqtt_password:
9125  4040 000000000000  	ds.b	11
9126                     	xdef	_stored_mqtt_password
9127  404b               _stored_IO_16to9:
9128  404b 00            	ds.b	1
9129                     	xdef	_stored_IO_16to9
9130  404c               _stored_config_settings:
9131  404c 000000000000  	ds.b	6
9132                     	xdef	_stored_config_settings
9133                     	xdef	_stack_limit2
9134                     	xdef	_stack_limit1
9135                     	xref	_mqtt_disconnect
9136                     	xref	_mqtt_subscribe
9137                     	xref	_mqtt_publish
9138                     	xref	_mqtt_connect
9139                     	xref	_mqtt_init
9140                     	xref	_strlen
9141                     	xref	_strcat
9142                     	xref	_wait_timer
9143                     	xref	_arp_timer_expired
9144                     	xref	_periodic_timer_expired
9145                     	xref	_clock_init
9146                     	xref	_LEDcontrol
9147                     	xref	_gpio_init
9148                     	xref	_check_mqtt_server_arp_entry
9149                     	xref	_uip_arp_timer
9150                     	xref	_uip_arp_out
9151                     	xref	_uip_arp_arpin
9152                     	xref	_uip_arp_init
9153                     	xref	_uip_ethaddr
9154                     	xref	_uip_mqttserveraddr
9155                     	xref	_uip_draddr
9156                     	xref	_uip_netmask
9157                     	xref	_uip_hostaddr
9158                     	xref	_uip_process
9159                     	xref	_uip_conns
9160                     	xref	_uip_conn
9161                     	xref	_uip_len
9162                     	xref	_uip_appdata
9163                     	xref	_htons
9164                     	xref	_uip_connect
9165                     	xref	_uip_buf
9166                     	xref	_uip_init
9167                     	xref	_GpioSetPin
9168                     	xref	_HttpDInit
9169                     	xref	_emb_itoa
9170                     	xref	_Enc28j60Send
9171                     	xref	_Enc28j60Receive
9172                     	xref	_Enc28j60Init
9173                     	xref	_spi_init
9174                     	xdef	_publish_pinstate_all
9175                     	xdef	_publish_pinstate
9176                     	xdef	_publish_outbound
9177                     	xdef	_publish_callback
9178                     	xdef	_mqtt_sanity_check
9179                     	xdef	_mqtt_startup
9180                     	xdef	_debugflash
9181                     	xdef	_fastflash
9182                     	xdef	_oneflash
9183                     	xdef	_reboot
9184                     	xdef	_restart
9185                     	xdef	_check_restart_reboot
9186                     	xdef	_check_reset_button
9187                     	xdef	_write_output_registers
9188                     	xdef	_read_input_registers
9189                     	xdef	_check_runtime_changes
9190                     	xdef	_update_mac_string
9191                     	xdef	_check_eeprom_settings
9192                     	xdef	_unlock_eeprom
9193                     	xdef	_main
9194                     	switch	.const
9195  9e77               L5242:
9196  9e77 2f7374617465  	dc.b	"/state",0
9197  9e7e               L7632:
9198  9e7e 2f6f75745f6f  	dc.b	"/out_off",0
9199  9e87               L3632:
9200  9e87 2f6f75745f6f  	dc.b	"/out_on",0
9201  9e8f               L5532:
9202  9e8f 2f696e5f6f66  	dc.b	"/in_off",0
9203  9e97               L1532:
9204  9e97 2f696e5f6f6e  	dc.b	"/in_on",0
9205  9e9e               L5302:
9206  9e9e 6f6e6c696e65  	dc.b	"online",0
9207  9ea5               L5202:
9208  9ea5 2f7374617465  	dc.b	"/state-req",0
9209  9eb0               L5102:
9210  9eb0 2f6f666600    	dc.b	"/off",0
9211  9eb5               L5002:
9212  9eb5 2f6f6e00      	dc.b	"/on",0
9213  9eb9               L1771:
9214  9eb9 6f66666c696e  	dc.b	"offline",0
9215  9ec1               L7671:
9216  9ec1 2f7374617475  	dc.b	"/status",0
9217                     	xref.b	c_lreg
9237                     	xref	c_ladc
9238                     	xref	c_lcmp
9239                     	xref	c_ltor
9240                     	xref	c_eewrw
9241                     	xref	c_eewrc
9242                     	end
